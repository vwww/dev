/*https://js.simperium.com/v0.1/*/function diff_match_patch(){this.Diff_Timeout=1,this.Diff_EditCost=4,this.Match_Threshold=.5,this.Match_Distance=1e3,this.Patch_DeleteThreshold=.5,this.Patch_Margin=4,this.Match_MaxBits=32}(function(){var t,e=function(t,e){return function(){return t.apply(e,arguments)}},d={}.hasOwnProperty;t=function(){function t(){this.patch_apply_with_offsets=e(this.patch_apply_with_offsets,this),this.transform_object_diff=e(this.transform_object_diff,this),this.transform_list_diff_dmp=e(this.transform_list_diff_dmp,this),this.transform_list_diff=e(this.transform_list_diff,this),this.apply_diff=e(this.apply_diff,this),this.apply_object_diff_with_offsets=e(this.apply_object_diff_with_offsets,this),this.apply_object_diff=e(this.apply_object_diff,this),this.apply_list_diff_dmp=e(this.apply_list_diff_dmp,this),this.apply_list_diff=e(this.apply_list_diff,this),this.diff=e(this.diff,this),this.object_diff=e(this.object_diff,this),this._text_to_array=e(this._text_to_array,this),this._serialize_to_text=e(this._serialize_to_text,this),this.list_diff_dmp=e(this.list_diff_dmp,this),this.list_diff=e(this.list_diff,this),this._common_suffix=e(this._common_suffix,this),this._common_prefix=e(this._common_prefix,this),this.object_equals=e(this.object_equals,this),this.list_equals=e(this.list_equals,this),this.equals=e(this.equals,this),this.deepCopy=e(this.deepCopy,this),this.typeOf=e(this.typeOf,this),this.entries=e(this.entries,this),this.dmp=new diff_match_patch}return t.prototype.entries=function(t){var e,i;for(e in i=0,t)d.call(t,e)&&i++;return i},t.prototype.typeOf=function(t){var e;return"object"===(e=typeof t)&&(t?"number"!=typeof t.length||"function"!=typeof t.splice||t.propertyIsEnumerable("length")||(e="array"):e="null"),e},t.prototype.deepCopy=function(t){return JSON.parse(JSON.stringify(t))},t.prototype.equals=function(t,e){var i,n;return i=this.typeOf(t),n=this.typeOf(e),"boolean"===i&&"number"===n?Number(t)===e:"number"===i&&"boolean"===n?Number(e)===t:i===n&&("array"===i?this.list_equals(t,e):"object"===i?this.object_equals(t,e):t===e)},t.prototype.list_equals=function(t,e){var i,n,s;if((i=t.length)!==e.length)return!1;for(n=s=0;0<=i?s<i:i<s;n=0<=i?++s:--s)if(!this.equals(t[n],e[n]))return!1;return!0},t.prototype.object_equals=function(t,e){for(var i in t)if(d.call(t,i)&&!(i in e&&this.equals(t[i],e[i])))return!1;for(i in e)if(d.call(e,i)&&!(i in t))return!1;return!0},t.prototype._common_prefix=function(t,e){var i,n,s;for(n=Math.min(t.length,e.length),i=s=0;0<=n?s<n:n<s;i=0<=n?++s:--s)if(!this.equals(t[i],e[i]))return i;return n},t.prototype._common_suffix=function(t,e){var i,n,s,r,o;if(n=t.length,s=e.length,0===(r=Math.min(t.length,e.length)))return 0;for(i=o=0;0<=r?o<r:r<o;i=0<=r?++o:--o)if(!this.equals(t[n-i-1],e[s-i-1]))return i;return r},t.prototype.list_diff=function(t,e,i){var n,s,r,o,a,h,f;i=null!=i&&"item"in i?i.item:null,n={},r=t.length,o=e.length,h=this._common_prefix(t,e),s=this._common_suffix(t,e),t=t.slice(h,r-s),e=e.slice(h,o-s),r=t.length,o=e.length,a=Math.max(r,o);for(s=f=0;0<=a?f<=a:a<=f;s=0<=a?++f:--f)s<r&&s<o?this.equals(t[s],e[s])||(n[s+h]=this.diff(t[s],e[s],i)):s<r?n[s+h]={o:"-"}:s<o&&(n[s+h]={o:"+",v:e[s]});return n},t.prototype.list_diff_dmp=function(t,e,i){return t=this._serialize_to_text(t),e=this._serialize_to_text(e),e=this.dmp.diff_lineMode_(t,e),this.dmp.diff_cleanupEfficiency(e),this.dmp.diff_toDelta(e)},t.prototype._serialize_to_text=function(t){var e,i,n,s;for(i="",n=0,s=t.length;n<s;n++)e=t[n],i+=JSON.stringify(e)+"\n";return i},t.prototype._text_to_array=function(t){var e,i,n,s;for(s=[],i=0,n=(t=t.split("\n")).length;i<n;i++)0<(e=t[i]).length&&s.push(JSON.parse(e));return s},t.prototype.object_diff=function(t,e,i){var n,s,r;if(n={},null!=i&&"attributes"in i&&(i=i.attributes),null==t||null==e)return{};for(s in t)d.call(t,s)&&(r=null!=i&&s in i?i[s]:null,s in e?this.equals(t[s],e[s])||(n[s]=this.diff(t[s],e[s],r)):n[s]={o:"-"});for(s in e)d.call(e,s)&&(s in t||null==e[s]||(n[s]={o:"+",v:e[s]}));return n},t.prototype.diff=function(t,e,i){var n;if(this.equals(t,e))return{};if(null!=i&&"attributes"in i&&(i=i.attributes),null!=i&&"otype"in i)switch(n=i.otype,n){case"replace":return{o:"r",v:e};case"list":return{o:"L",v:this.list_diff(t,e,i)};case"list_dmp":return{o:"dL",v:this.list_diff_dmp(t,e,i)};case"integer":return{o:"I",v:e-t};case"string":if(2<(n=this.dmp.diff_main(t,e)).length&&this.dmp.diff_cleanupEfficiency(n),0<n.length)return{o:"d",v:this.dmp.diff_toDelta(n)}}if((n=this.typeOf(t))!==this.typeOf(e))return{o:"r",v:e};switch(n){case"boolean":case"number":case"array":return{o:"r",v:e};case"object":return{o:"O",v:this.object_diff(t,e,i)};case"string":if(2<(n=this.dmp.diff_main(t,e)).length&&this.dmp.diff_cleanupEfficiency(n),0<n.length)return{o:"d",v:this.dmp.diff_toDelta(n)}}return{}},t.prototype.apply_list_diff=function(t,e){var i,n,s,r,o,a,h,f;for(o in a=this.deepCopy(t),r=[],i=[],e)d.call(e,o)&&(r.push(o),r.sort());for(o=0,f=r.length;o<f;o++){n=e[s=r[o]];for(var l=void 0,c=void 0,u=(c=[],l=0,i.length);l<u;l++)(h=i[l])<=s&&c.push(h);switch(s-=h=c.length,n.o){case"+":[].splice.apply(a,[s,s-1-s+1].concat(n=n.v));break;case"-":[].splice.apply(a,[s,s-s+1].concat(n=[])),i[i.length]=s;break;case"r":a[s]=n.v;break;case"I":a[s]+=n.v;break;case"L":a[s]=this.apply_list_diff(a[s],n.v);break;case"dL":a[s]=this.apply_list_diff_dmp(a[s],n.v);break;case"O":a[s]=this.apply_object_diff(a[s],n.v);break;case"d":n=this.dmp.diff_fromDelta(a[s],n.v),n=this.dmp.patch_make(a[s],n),n=this.dmp.patch_apply(n,a[s]),a[s]=n[0]}}return a},t.prototype.apply_list_diff_dmp=function(t,e){var i,n;return n=this._serialize_to_text(t),i=this.dmp.diff_fromDelta(n,e),i=this.dmp.patch_make(n,i),n=this.dmp.patch_apply(i,n),this._text_to_array(n[0])},t.prototype.apply_object_diff=function(t,e){var i,n,s;for(i in s=this.deepCopy(t),e)d.call(e,i)&&("-"===(n=e[i]).o?delete s[i]:s[i]=this.apply_diff(s[i],n));return s},t.prototype.apply_object_diff_with_offsets=function(t,e,i,n){var s,r;for(r in t=this.deepCopy(t),e)if(d.call(e,r))switch(s=e[r],s.o){case"+":t[r]=s.v;break;case"-":delete t[r];break;case"r":t[r]=s.v;break;case"I":t[r]+=s.v;break;case"L":t[r]=this.apply_list_diff(t[r],s.v);break;case"O":t[r]=this.apply_object_diff(t[r],s.v);break;case"d":s=this.dmp.diff_fromDelta(t[r],s.v),s=this.dmp.patch_make(t[r],s),t[r]=r===i?this.patch_apply_with_offsets(s,t[r],n):(s=this.dmp.patch_apply(s,t[r]))[0]}return t},t.prototype.apply_diff=function(t,e){var i;switch(e.o){case"+":return e.v;case"-":return null;case"r":return e.v;case"I":return t+e.v;case"L":return this.apply_list_diff(t,e.v);case"dL":return this.apply_list_diff_dmp(t,e.v);case"O":return this.apply_object_diff(t,e.v);case"d":return i=this.dmp.diff_fromDelta(t,e.v),i=this.dmp.patch_make(t,i),(i=this.dmp.patch_apply(i,t))[0]}},t.prototype.transform_list_diff=function(t,e,i,n){var s,r,o,a,h,f,l,c,u,p;for(h in s={},o=[],r=[],n=null!=n&&"item"in n?n.item:null,e)d.call(e,h)&&(a=e[h],h=parseInt(h),"+"===a.o&&o.push(h),"-"===a.o&&r.push(h));for(h in l=f=0,t)d.call(t,h)&&(a=t[h],h=parseInt(h),u=function(){var t,e,i;for(i=[],t=0,e=o.length;t<e;t++)(p=o[t])<h&&i.push(p);return i}().length,c=function(){var t,e,i;for(i=[],t=0,e=r.length;t<e;t++)(p=r[t])<h&&i.push(p);return i}().length,f=h=f+1===h?h+l:h+u-c,l=u-c,s[c=String(h)]=a,c in e&&("+"!==a.o||"+"!==e[h].o)&&("-"===a.o?"-"===e[h].o&&delete s[c]:"-"===e[h].o?("r"===a.o&&(s[c]={o:"+",v:a.v}),!1===a.o&&(s[c]={o:"+",v:this.apply_object_diff(i[c],a.v)})):((u={})[c]=a,(a={})[c]=e[h],a=this.transform_object_diff(u,a,i,n),s[c]=a[c])));return s},t.prototype.transform_list_diff_dmp=function(t,e,i,n){return i=this._serialize_to_text(i),t=this.dmp.patch_make(i,this.dmp.diff_fromDelta(i,t)),e=this.dmp.patch_make(i,this.dmp.diff_fromDelta(i,e)),e=this.dmp.patch_apply(e,i)[0],(t=this.dmp.patch_apply(t,e)[0])!==e&&(2<(e=this.dmp.diff_lineMode_(e,t)).length&&this.dmp.diff_cleanupEfficiency(e),0<e.length)?this.dmp.diff_toDelta(e):""},t.prototype.transform_object_diff=function(t,e,i,n){var s,r,o,a;for(o in s=this.deepCopy(t),null!=n&&"attributes"in n&&(n=n.attributes),t)if(d.call(t,o)&&(r=t[o],o in e))return n=null!=n&&"attributes"in n?null!=(n=n.attributes)&&o in n?n[o]:null:null,t=i[o],e=e[o],"+"===r.o&&"+"===e.o?this.equals(r.v,e.v)?delete s[o]:s[o]=this.diff(e.v,r.v,n):"-"===r.o&&"-"===e.o?delete s[o]:"-"===e.o&&"+"!==(a=r.o)&&"-"!==a?(s[o]={o:"+"},s[o].v=this.apply_diff(t,r)):"O"===r.o&&"O"===e.o?s[o]={o:"O",v:this.transform_object_diff(r.v,e.v,t,n)}:"L"===r.o&&"L"===e.o?s[o]={o:"L",v:this.transform_list_diff(r.v,e.v,t,n)}:"dL"===r.o&&"dL"===e.o?s[o]={o:"dL",v:this.transform_list_diff_dmp(r.v,e.v,t,n)}:"d"===r.o&&"d"===e.o&&(delete s[o],n=this.dmp.patch_make(t,this.dmp.diff_fromDelta(t,r.v)),r=this.dmp.patch_make(t,this.dmp.diff_fromDelta(t,e.v)),r=this.dmp.patch_apply(r,t)[0],(n=this.dmp.patch_apply(n,r)[0])!==r&&(2<(n=this.dmp.diff_main(r,n)).length&&this.dmp.diff_cleanupEfficiency(n),0<n.length&&(s[o]={o:"d",v:this.dmp.diff_toDelta(n)}))),s},t.prototype.patch_apply_with_offsets=function(t,e,i){var n,s,r,o,a,h,f,l,c,u,p,d,_,g,m,b,y;if(0===t.length)return e;for(t=this.dmp.patch_deepCopy(t),e=(u=this.dmp.patch_addPadding(t))+e+u,this.dmp.patch_splitMax(t),d=_=r=0,m=t.length;0<=m?_<m:m<_;d=0<=m?++_:--_)if(a=t[d].start2+r,o=-1,(f=this.dmp.diff_text1(t[d].diffs)).length>this.dmp.Match_MaxBits?-1!==(p=this.dmp.match_main(e,f.substring(0,this.dmp.Match_MaxBits),a))&&(-1===(o=this.dmp.match_main(e,f.substring(f.length-this.dmp.Match_MaxBits),a+f.length-this.dmp.Match_MaxBits))||o<=p)&&(p=-1):p=this.dmp.match_main(e,f,a),-1===p)r-=t[d].length2-t[d].length1;else if(r=p-a,o=-1===o?e.substring(p,p+f.length):e.substring(p,o+this.dmp.Match_MaxBits),o=this.dmp.diff_main(f,o,!1),!(f.length>this.dmp.Match_MaxBits&&this.dmp.diff_levenshtein(o)/f.length>this.dmp.Patch_DeleteThreshold))for(h=a=f=0,b=t[d].diffs.length;0<=b?a<b:b<a;h=0<=b?++a:--a){if(0!==(c=t[d].diffs[h])[0]&&(l=this.dmp.diff_xIndex(o,f)),1===c[0])for(e=e.substring(0,p+l)+c[1]+e.substring(p+l),h=n=0,s=i.length;0<=s?n<s:s<n;h=0<=s?++n:--n)i[h]+u.length>p+l&&(i[h]+=c[1].length);else if(-1===c[0])for(s=p+l,n=p+this.dmp.diff_xIndex(o,f+c[1].length),e=e.substring(0,s)+e.substring(n),h=g=0,y=i.length;0<=y?g<y:y<g;h=0<=y?++g:--g)i[h]+u.length>s&&(i[h]=i[h]+u.length<n?s-u.length:i[h]-(n-s));-1!==c[0]&&(f+=c[1].length)}return e.substring(u.length,e.length-u.length)},t}(),window.jsondiff=t}).call(this);var DIFF_DELETE=-1,DIFF_INSERT=1,DIFF_EQUAL=0,JSON;diff_match_patch.prototype.diff_main=function(t,e,i,n){if(void 0===n&&(n=this.Diff_Timeout<=0?Number.MAX_VALUE:(new Date).getTime()+1e3*this.Diff_Timeout),null==t||null==e)throw Error("Null input. (diff_main)");if(t==e)return t?[[DIFF_EQUAL,t]]:[];void 0===i&&(i=!0);var s=i,r=this.diff_commonPrefix(t,e);i=t.substring(0,r),t=t.substring(r),e=e.substring(r);r=this.diff_commonSuffix(t,e);var o=t.substring(t.length-r);return t=t.substring(0,t.length-r),e=e.substring(0,e.length-r),t=this.diff_compute_(t,e,s,n),i&&t.unshift([DIFF_EQUAL,i]),o&&t.push([DIFF_EQUAL,o]),this.diff_cleanupMerge(t),t},diff_match_patch.prototype.diff_compute_=function(t,e,i,n){if(!t)return[[DIFF_INSERT,e]];if(!e)return[[DIFF_DELETE,t]];var s=t.length>e.length?t:e,r=t.length>e.length?e:t,o=s.indexOf(r);return-1!=o?(i=[[DIFF_INSERT,s.substring(0,o)],[DIFF_EQUAL,r],[DIFF_INSERT,s.substring(o+r.length)]],t.length>e.length&&(i[0][0]=i[2][0]=DIFF_DELETE),i):1==r.length?[[DIFF_DELETE,t],[DIFF_INSERT,e]]:(s=this.diff_halfMatch_(t,e))?(e=s[1],r=s[3],t=s[4],s=this.diff_main(s[0],s[2],i,n),i=this.diff_main(e,r,i,n),s.concat([[DIFF_EQUAL,t]],i)):i&&100<t.length&&100<e.length?this.diff_lineMode_(t,e,n):this.diff_bisect_(t,e,n)},diff_match_patch.prototype.diff_lineMode_=function(t,e,i){var n=this.diff_linesToChars_(t,e);t=n.chars1,e=n.chars2,n=n.lineArray,t=this.diff_main(t,e,!1,i),this.diff_charsToLines_(t,n),this.diff_cleanupSemantic(t),t.push([DIFF_EQUAL,""]);for(var s=n=e=0,r="",o="";e<t.length;){switch(t[e][0]){case DIFF_INSERT:s++,o+=t[e][1];break;case DIFF_DELETE:n++,r+=t[e][1];break;case DIFF_EQUAL:if(1<=n&&1<=s){for(t.splice(e-n-s,n+s),e=e-n-s,s=(n=this.diff_main(r,o,!1,i)).length-1;0<=s;s--)t.splice(e,0,n[s]);e+=n.length}n=s=0,o=r=""}e++}return t.pop(),t},diff_match_patch.prototype.diff_bisect_=function(t,e,i){for(var n=t.length,s=e.length,r=Math.ceil((n+s)/2),o=2*r,a=Array(o),h=Array(o),f=0;f<o;f++)a[f]=-1,h[f]=-1;a[r+1]=0;for(var l=(h[r+1]=0)!=(f=n-s)%2,c=0,u=0,p=0,d=0,_=0;_<r&&!((new Date).getTime()>i);_++){for(var g=-_+c;g<=_-u;g+=2){for(var m,b=r+g,y=(m=g==-_||g!=_&&a[b-1]<a[b+1]?a[b+1]:a[b-1]+1)-g;m<n&&y<s&&t.charAt(m)==e.charAt(y);)m++,y++;if(n<(a[b]=m))u+=2;else if(s<y)c+=2;else if(l&&(0<=(b=r+f-g)&&b<o&&-1!=h[b])){var v=n-h[b];if(v<=m)return this.diff_bisectSplit_(t,e,m,y,i)}}for(g=-_+p;g<=_-d;g+=2){for(b=r+g,m=(v=g==-_||g!=_&&h[b-1]<h[b+1]?h[b+1]:h[b-1]+1)-g;v<n&&m<s&&t.charAt(n-v-1)==e.charAt(s-m-1);)v++,m++;if(n<(h[b]=v))d+=2;else if(s<m)p+=2;else if(!l&&(0<=(b=r+f-g)&&b<o&&-1!=a[b]&&(y=r+(m=a[b])-b,(v=n-v)<=m)))return this.diff_bisectSplit_(t,e,m,y,i)}}return[[DIFF_DELETE,t],[DIFF_INSERT,e]]},diff_match_patch.prototype.diff_bisectSplit_=function(t,e,i,n,s){var r=t.substring(0,i),o=e.substring(0,n);return t=t.substring(i),e=e.substring(n),r=this.diff_main(r,o,!1,s),s=this.diff_main(t,e,!1,s),r.concat(s)},diff_match_patch.prototype.diff_linesToChars_=function(t,e){function i(t){for(var e="",i=0,n=-1,s=o.length;n<t.length-1;){-1==(n=t.indexOf("\n",i))&&(n=t.length-1);var r=t.substring(i,n+1);i=n+1;(a.hasOwnProperty?a.hasOwnProperty(r):void 0!==a[r])?e+=String.fromCharCode(a[r]):(e+=String.fromCharCode(s),a[r]=s,o[s++]=r)}return e}var o=[],a={};return o[0]="",{chars1:i(t),chars2:i(e),lineArray:o}},diff_match_patch.prototype.diff_charsToLines_=function(t,e){for(var i=0;i<t.length;i++){for(var n=t[i][1],s=[],r=0;r<n.length;r++)s[r]=e[n.charCodeAt(r)];t[i][1]=s.join("")}},diff_match_patch.prototype.diff_commonPrefix=function(t,e){if(!t||!e||t.charAt(0)!=e.charAt(0))return 0;for(var i=0,n=Math.min(t.length,e.length),s=n,r=0;i<s;)t.substring(r,s)==e.substring(r,s)?r=i=s:n=s,s=Math.floor((n-i)/2+i);return s},diff_match_patch.prototype.diff_commonSuffix=function(t,e){if(!t||!e||t.charAt(t.length-1)!=e.charAt(e.length-1))return 0;for(var i=0,n=Math.min(t.length,e.length),s=n,r=0;i<s;)t.substring(t.length-s,t.length-r)==e.substring(e.length-s,e.length-r)?r=i=s:n=s,s=Math.floor((n-i)/2+i);return s},diff_match_patch.prototype.diff_commonOverlap_=function(t,e){var i=t.length,n=e.length;if(0==i||0==n)return 0;if(n<i?t=t.substring(i-n):i<n&&(e=e.substring(0,i)),i=Math.min(i,n),t==e)return i;n=0;for(var s=1;;){var r=t.substring(i-s);if(-1==(r=e.indexOf(r)))return n;s+=r,0!=r&&t.substring(i-s)!=e.substring(0,s)||(n=s,s++)}},diff_match_patch.prototype.diff_halfMatch_=function(t,e){function i(t,e,i){for(var n,s,r,o,a=t.substring(i,i+Math.floor(t.length/4)),h=-1,f="";-1!=(h=e.indexOf(a,h+1));){var l=u.diff_commonPrefix(t.substring(i),e.substring(h)),c=u.diff_commonSuffix(t.substring(0,i),e.substring(0,h));f.length<c+l&&(f=e.substring(h-c,h)+e.substring(h,h+l),n=t.substring(0,i-c),s=t.substring(i+l),r=e.substring(0,h-c),o=e.substring(h+l))}return 2*f.length>=t.length?[n,s,r,o,f]:null}if(this.Diff_Timeout<=0)return null;var n=t.length>e.length?t:e,s=t.length>e.length?e:t;if(n.length<4||2*s.length<n.length)return null;var r,o,u=this,a=i(n,s,Math.ceil(n.length/4));n=i(n,s,Math.ceil(n.length/2));return a||n?(a=n?a&&a[4].length>n[4].length?a:n:a,t.length>e.length?(n=a[0],s=a[1],r=a[2],o=a[3]):(r=a[0],o=a[1],n=a[2],s=a[3]),[n,s,r,o,a[4]]):null},diff_match_patch.prototype.diff_cleanupSemantic=function(t){for(var e=!1,i=[],n=0,s=null,r=0,o=0,a=0,h=0,f=0;r<t.length;)t[r][0]==DIFF_EQUAL?(o=h,a=f,f=h=0,s=t[i[n++]=r][1]):(t[r][0]==DIFF_INSERT?h+=t[r][1].length:f+=t[r][1].length,s&&s.length<=Math.max(o,a)&&s.length<=Math.max(h,f)&&(t.splice(i[n-1],0,[DIFF_DELETE,s]),t[i[n-1]+1][0]=DIFF_INSERT,n--,r=0<--n?i[n-1]:-1,f=h=a=o=0,e=!(s=null))),r++;for(e&&this.diff_cleanupMerge(t),this.diff_cleanupSemanticLossless(t),r=1;r<t.length;)t[r-1][0]==DIFF_DELETE&&t[r][0]==DIFF_INSERT&&(e=t[r-1][1],i=t[r][1],n=this.diff_commonOverlap_(e,i),(s=this.diff_commonOverlap_(i,e))<=n?(n>=e.length/2||n>=i.length/2)&&(t.splice(r,0,[DIFF_EQUAL,i.substring(0,n)]),t[r-1][1]=e.substring(0,e.length-n),t[r+1][1]=i.substring(n),r++):(s>=e.length/2||s>=i.length/2)&&(t.splice(r,0,[DIFF_EQUAL,e.substring(0,s)]),t[r-1][0]=DIFF_INSERT,t[r-1][1]=i.substring(0,i.length-s),t[r+1][0]=DIFF_DELETE,t[r+1][1]=e.substring(s),r++),r++),r++},diff_match_patch.prototype.diff_cleanupSemanticLossless=function(t){function e(t,e){if(!t||!e)return 6;var i=t.charAt(t.length-1),n=e.charAt(0),s=i.match(diff_match_patch.nonAlphaNumericRegex_),r=n.match(diff_match_patch.nonAlphaNumericRegex_),o=s&&i.match(diff_match_patch.whitespaceRegex_),a=r&&n.match(diff_match_patch.whitespaceRegex_),h=(i=o&&i.match(diff_match_patch.linebreakRegex_),n=a&&n.match(diff_match_patch.linebreakRegex_),i&&t.match(diff_match_patch.blanklineEndRegex_)),f=n&&e.match(diff_match_patch.blanklineStartRegex_);return h||f?5:i||n?4:s&&!o&&a?3:o||a?2:s||r?1:0}for(var i=1;i<t.length-1;){if(t[i-1][0]==DIFF_EQUAL&&t[i+1][0]==DIFF_EQUAL){var n=t[i-1][1],s=t[i][1],r=t[i+1][1];if(a=this.diff_commonSuffix(n,s)){var o=s.substring(s.length-a);n=n.substring(0,n.length-a),s=o+s.substring(0,s.length-a),r=o+r}for(var a=n,h=(o=s,r),f=e(n,s)+e(s,r);s.charAt(0)===r.charAt(0);){n=n+s.charAt(0),s=s.substring(1)+r.charAt(0),r=r.substring(1);var l=e(n,s)+e(s,r);f<=l&&(f=l,a=n,o=s,h=r)}t[i-1][1]!=a&&(a?t[i-1][1]=a:(t.splice(i-1,1),i--),t[i][1]=o,h?t[i+1][1]=h:(t.splice(i+1,1),i--))}i++}},diff_match_patch.nonAlphaNumericRegex_=/[^a-zA-Z0-9]/,diff_match_patch.whitespaceRegex_=/\s/,diff_match_patch.linebreakRegex_=/[\r\n]/,diff_match_patch.blanklineEndRegex_=/\n\r?\n$/,diff_match_patch.blanklineStartRegex_=/^\r?\n\r?\n/,diff_match_patch.prototype.diff_cleanupEfficiency=function(t){for(var e=!1,i=[],n=0,s=null,r=0,o=!1,a=!1,h=!1,f=!1;r<t.length;)t[r][0]==DIFF_EQUAL?(s=t[r][1].length<this.Diff_EditCost&&(h||f)?(o=h,a=f,t[i[n++]=r][1]):(n=0,null),h=f=!1):(t[r][0]==DIFF_DELETE?f=!0:h=!0,s&&(o&&a&&h&&f||s.length<this.Diff_EditCost/2&&3==o+a+h+f)&&(t.splice(i[n-1],0,[DIFF_DELETE,s]),t[i[n-1]+1][0]=DIFF_INSERT,n--,s=null,o&&a?(h=f=!0,n=0):(r=0<--n?i[n-1]:-1,h=f=!1),e=!0)),r++;e&&this.diff_cleanupMerge(t)},diff_match_patch.prototype.diff_cleanupMerge=function(t){t.push([DIFF_EQUAL,""]);for(var e,i=0,n=0,s=0,r="",o="";i<t.length;)switch(t[i][0]){case DIFF_INSERT:s++,o+=t[i][1],i++;break;case DIFF_DELETE:n++,r+=t[i][1],i++;break;case DIFF_EQUAL:1<n+s?(0!==n&&0!==s&&(0!==(e=this.diff_commonPrefix(o,r))&&(0<i-n-s&&t[i-n-s-1][0]==DIFF_EQUAL?t[i-n-s-1][1]+=o.substring(0,e):(t.splice(0,0,[DIFF_EQUAL,o.substring(0,e)]),i++),o=o.substring(e),r=r.substring(e)),0!==(e=this.diff_commonSuffix(o,r))&&(t[i][1]=o.substring(o.length-e)+t[i][1],o=o.substring(0,o.length-e),r=r.substring(0,r.length-e))),0===n?t.splice(i-s,n+s,[DIFF_INSERT,o]):0===s?t.splice(i-n,n+s,[DIFF_DELETE,r]):t.splice(i-n-s,n+s,[DIFF_DELETE,r],[DIFF_INSERT,o]),i=i-n-s+(n?1:0)+(s?1:0)+1):0!==i&&t[i-1][0]==DIFF_EQUAL?(t[i-1][1]+=t[i][1],t.splice(i,1)):i++,n=s=0,o=r=""}for(""===t[t.length-1][1]&&t.pop(),n=!1,i=1;i<t.length-1;)t[i-1][0]==DIFF_EQUAL&&t[i+1][0]==DIFF_EQUAL&&(t[i][1].substring(t[i][1].length-t[i-1][1].length)==t[i-1][1]?(t[i][1]=t[i-1][1]+t[i][1].substring(0,t[i][1].length-t[i-1][1].length),t[i+1][1]=t[i-1][1]+t[i+1][1],t.splice(i-1,1),n=!0):t[i][1].substring(0,t[i+1][1].length)==t[i+1][1]&&(t[i-1][1]+=t[i+1][1],t[i][1]=t[i][1].substring(t[i+1][1].length)+t[i+1][1],t.splice(i+1,1),n=!0)),i++;n&&this.diff_cleanupMerge(t)},diff_match_patch.prototype.diff_xIndex=function(t,e){var i,n=0,s=0,r=0,o=0;for(i=0;i<t.length&&(t[i][0]!==DIFF_INSERT&&(n+=t[i][1].length),t[i][0]!==DIFF_DELETE&&(s+=t[i][1].length),!(e<n));i++)r=n,o=s;return t.length!=i&&t[i][0]===DIFF_DELETE?o:o+(e-r)},diff_match_patch.prototype.diff_prettyHtml=function(t){for(var e=[],i=/&/g,n=/</g,s=/>/g,r=/\n/g,o=0;o<t.length;o++){var a=t[o][0],h=t[o][1].replace(i,"&amp;").replace(n,"&lt;").replace(s,"&gt;").replace(r,"&para;<br>");switch(a){case DIFF_INSERT:e[o]='<ins style="background:#e6ffe6;">'+h+"</ins>";break;case DIFF_DELETE:e[o]='<del style="background:#ffe6e6;">'+h+"</del>";break;case DIFF_EQUAL:e[o]="<span>"+h+"</span>"}}return e.join("")},diff_match_patch.prototype.diff_text1=function(t){for(var e=[],i=0;i<t.length;i++)t[i][0]!==DIFF_INSERT&&(e[i]=t[i][1]);return e.join("")},diff_match_patch.prototype.diff_text2=function(t){for(var e=[],i=0;i<t.length;i++)t[i][0]!==DIFF_DELETE&&(e[i]=t[i][1]);return e.join("")},diff_match_patch.prototype.diff_levenshtein=function(t){for(var e=0,i=0,n=0,s=0;s<t.length;s++){var r=t[s][1];switch(t[s][0]){case DIFF_INSERT:i+=r.length;break;case DIFF_DELETE:n+=r.length;break;case DIFF_EQUAL:e+=Math.max(i,n),n=i=0}}return e+Math.max(i,n)},diff_match_patch.prototype.diff_toDelta=function(t){for(var e=[],i=0;i<t.length;i++)switch(t[i][0]){case DIFF_INSERT:e[i]="+"+encodeURI(t[i][1]);break;case DIFF_DELETE:e[i]="-"+t[i][1].length;break;case DIFF_EQUAL:e[i]="="+t[i][1].length}return e.join("\t").replace(/%20/g," ")},diff_match_patch.prototype.diff_fromDelta=function(t,e){for(var i=[],n=0,s=0,r=e.split(/\t/g),o=0;o<r.length;o++){var a=r[o].substring(1);switch(r[o].charAt(0)){case"+":try{i[n++]=[DIFF_INSERT,decodeURI(a)]}catch(t){throw Error("Illegal escape in diff_fromDelta: "+a)}break;case"-":case"=":var h=parseInt(a,10);if(isNaN(h)||h<0)throw Error("Invalid number in diff_fromDelta: "+a);a=t.substring(s,s+=h),"="==r[o].charAt(0)?i[n++]=[DIFF_EQUAL,a]:i[n++]=[DIFF_DELETE,a];break;default:if(r[o])throw Error("Invalid diff operation in diff_fromDelta: "+r[o])}}if(s!=t.length)throw Error("Delta length ("+s+") does not equal source text length ("+t.length+").");return i},diff_match_patch.prototype.match_main=function(t,e,i){if(null==t||null==e||null==i)throw Error("Null input. (match_main)");return i=Math.max(0,Math.min(i,t.length)),t==e?0:t.length?t.substring(i,i+e.length)==e?i:this.match_bitap_(t,e,i):-1},diff_match_patch.prototype.match_bitap_=function(t,s,r){function e(t,e){var i=t/s.length,n=Math.abs(r-e);return o.Match_Distance?i+n/o.Match_Distance:n?1:i}if(s.length>this.Match_MaxBits)throw Error("Pattern too long for this browser.");var i=this.match_alphabet_(s),o=this,n=this.Match_Threshold;-1!=(c=t.indexOf(s,r))&&(n=Math.min(e(0,c),n),-1!=(c=t.lastIndexOf(s,r+s.length))&&(n=Math.min(e(0,c),n)));for(var a,h,f,l=1<<s.length-1,c=-1,u=s.length+t.length,p=0;p<s.length;p++){for(a=0,h=u;a<h;)e(p,r+h)<=n?a=h:u=h,h=Math.floor((u-a)/2+a);u=h,a=Math.max(1,r-h+1);var d=Math.min(r+h,t.length)+s.length;for((h=Array(d+2))[d+1]=(1<<p)-1;a<=d;d--){var _=i[t.charAt(d-1)];if(h[d]=0===p?(h[d+1]<<1|1)&_:(h[d+1]<<1|1)&_|(f[d+1]|f[d])<<1|1|f[d+1],h[d]&l&&(_=e(p,d-1))<=n){if(n=_,!(r<(c=d-1)))break;a=Math.max(1,2*r-c)}}if(e(p+1,r)>n)break;f=h}return c},diff_match_patch.prototype.match_alphabet_=function(t){for(var e={},i=0;i<t.length;i++)e[t.charAt(i)]=0;for(i=0;i<t.length;i++)e[t.charAt(i)]|=1<<t.length-i-1;return e},diff_match_patch.prototype.patch_addContext_=function(t,e){if(0!=e.length){for(var i=e.substring(t.start2,t.start2+t.length1),n=0;e.indexOf(i)!=e.lastIndexOf(i)&&i.length<this.Match_MaxBits-this.Patch_Margin-this.Patch_Margin;)n+=this.Patch_Margin,i=e.substring(t.start2-n,t.start2+t.length1+n);n+=this.Patch_Margin,(i=e.substring(t.start2-n,t.start2))&&t.diffs.unshift([DIFF_EQUAL,i]),(n=e.substring(t.start2+t.length1,t.start2+t.length1+n))&&t.diffs.push([DIFF_EQUAL,n]),t.start1-=i.length,t.start2-=i.length,t.length1+=i.length+n.length,t.length2+=i.length+n.length}},diff_match_patch.prototype.patch_make=function(t,e,i){var n;if("string"==typeof t&&"string"==typeof e&&void 0===i)n=t,2<(e=this.diff_main(n,e,!0)).length&&(this.diff_cleanupSemantic(e),this.diff_cleanupEfficiency(e));else if(t&&"object"==typeof t&&void 0===e&&void 0===i)e=t,n=this.diff_text1(e);else if("string"==typeof t&&e&&"object"==typeof e&&void 0===i)n=t;else{if("string"!=typeof t||"string"!=typeof e||!i||"object"!=typeof i)throw Error("Unknown call format to patch_make.");n=t,e=i}if(0===e.length)return[];i=[],t=new diff_match_patch.patch_obj;for(var s=0,r=0,o=0,a=n,h=0;h<e.length;h++){var f=e[h][0],l=e[h][1];switch(s||f===DIFF_EQUAL||(t.start1=r,t.start2=o),f){case DIFF_INSERT:t.diffs[s++]=e[h],t.length2+=l.length,n=n.substring(0,o)+l+n.substring(o);break;case DIFF_DELETE:t.length1+=l.length,t.diffs[s++]=e[h],n=n.substring(0,o)+n.substring(o+l.length);break;case DIFF_EQUAL:l.length<=2*this.Patch_Margin&&s&&e.length!=h+1?(t.diffs[s++]=e[h],t.length1+=l.length,t.length2+=l.length):l.length>=2*this.Patch_Margin&&s&&(this.patch_addContext_(t,a),i.push(t),t=new diff_match_patch.patch_obj,s=0,a=n,r=o)}f!==DIFF_INSERT&&(r+=l.length),f!==DIFF_DELETE&&(o+=l.length)}return s&&(this.patch_addContext_(t,a),i.push(t)),i},diff_match_patch.prototype.patch_deepCopy=function(t){for(var e=[],i=0;i<t.length;i++){var n=t[i],s=new diff_match_patch.patch_obj;s.diffs=[];for(var r=0;r<n.diffs.length;r++)s.diffs[r]=n.diffs[r].slice();s.start1=n.start1,s.start2=n.start2,s.length1=n.length1,s.length2=n.length2,e[i]=s}return e},diff_match_patch.prototype.patch_apply=function(t,e){if(0==t.length)return[e,[]];t=this.patch_deepCopy(t);var i=this.patch_addPadding(t);e=i+e+i,this.patch_splitMax(t);for(var n=0,s=[],r=0;r<t.length;r++){var o,a=t[r].start2+n,h=-1;if((l=this.diff_text1(t[r].diffs)).length>this.Match_MaxBits?-1!=(o=this.match_main(e,l.substring(0,this.Match_MaxBits),a))&&(-1==(h=this.match_main(e,l.substring(l.length-this.Match_MaxBits),a+l.length-this.Match_MaxBits))||h<=o)&&(o=-1):o=this.match_main(e,l,a),-1==o)s[r]=!1,n-=t[r].length2-t[r].length1;else if(s[r]=!0,n=o-a,l==(a=-1==h?e.substring(o,o+l.length):e.substring(o,h+this.Match_MaxBits)))e=e.substring(0,o)+this.diff_text2(t[r].diffs)+e.substring(o+l.length);else if(a=this.diff_main(l,a,!1),l.length>this.Match_MaxBits&&this.diff_levenshtein(a)/l.length>this.Patch_DeleteThreshold)s[r]=!1;else{this.diff_cleanupSemanticLossless(a);var f,l=0;for(h=0;h<t[r].diffs.length;h++){var c=t[r].diffs[h];c[0]!==DIFF_EQUAL&&(f=this.diff_xIndex(a,l)),c[0]===DIFF_INSERT?e=e.substring(0,o+f)+c[1]+e.substring(o+f):c[0]===DIFF_DELETE&&(e=e.substring(0,o+f)+e.substring(o+this.diff_xIndex(a,l+c[1].length))),c[0]!==DIFF_DELETE&&(l+=c[1].length)}}}return[e=e.substring(i.length,e.length-i.length),s]},diff_match_patch.prototype.patch_addPadding=function(t){for(var e=this.Patch_Margin,i="",n=1;n<=e;n++)i+=String.fromCharCode(n);for(n=0;n<t.length;n++)t[n].start1+=e,t[n].start2+=e;var s=(n=t[0]).diffs;if(0==s.length||s[0][0]!=DIFF_EQUAL)s.unshift([DIFF_EQUAL,i]),n.start1-=e,n.start2-=e,n.length1+=e,n.length2+=e;else if(e>s[0][1].length){var r=e-s[0][1].length;s[0][1]=i.substring(s[0][1].length)+s[0][1],n.start1-=r,n.start2-=r,n.length1+=r,n.length2+=r}return 0==(s=(n=t[t.length-1]).diffs).length||s[s.length-1][0]!=DIFF_EQUAL?(s.push([DIFF_EQUAL,i]),n.length1+=e,n.length2+=e):e>s[s.length-1][1].length&&(r=e-s[s.length-1][1].length,s[s.length-1][1]+=i.substring(0,r),n.length1+=r,n.length2+=r),i},diff_match_patch.prototype.patch_splitMax=function(t){for(var e=this.Match_MaxBits,i=0;i<t.length;i++)if(!(t[i].length1<=e)){var n=t[i];t.splice(i--,1);for(var s=n.start1,r=n.start2,o="";0!==n.diffs.length;){var a=new diff_match_patch.patch_obj,h=!0;for(a.start1=s-o.length,a.start2=r-o.length,""!==o&&(a.length1=a.length2=o.length,a.diffs.push([DIFF_EQUAL,o]));0!==n.diffs.length&&a.length1<e-this.Patch_Margin;){o=n.diffs[0][0];var f=n.diffs[0][1];o===DIFF_INSERT?(a.length2+=f.length,r+=f.length,a.diffs.push(n.diffs.shift()),h=!1):o===DIFF_DELETE&&1==a.diffs.length&&a.diffs[0][0]==DIFF_EQUAL&&f.length>2*e?(a.length1+=f.length,s+=f.length,h=!1,a.diffs.push([o,f]),n.diffs.shift()):(f=f.substring(0,e-a.length1-this.Patch_Margin),a.length1+=f.length,s+=f.length,o===DIFF_EQUAL?(a.length2+=f.length,r+=f.length):h=!1,a.diffs.push([o,f]),f==n.diffs[0][1]?n.diffs.shift():n.diffs[0][1]=n.diffs[0][1].substring(f.length))}o=(o=this.diff_text2(a.diffs)).substring(o.length-this.Patch_Margin),""!==(f=this.diff_text1(n.diffs).substring(0,this.Patch_Margin))&&(a.length1+=f.length,a.length2+=f.length,0!==a.diffs.length&&a.diffs[a.diffs.length-1][0]===DIFF_EQUAL?a.diffs[a.diffs.length-1][1]+=f:a.diffs.push([DIFF_EQUAL,f])),h||t.splice(++i,0,a)}}},diff_match_patch.prototype.patch_toText=function(t){for(var e=[],i=0;i<t.length;i++)e[i]=t[i];return e.join("")},diff_match_patch.prototype.patch_fromText=function(t){var e=[];if(!t)return e;t=t.split("\n");for(var i=0,n=/^@@ -(\d+),?(\d*) \+(\d+),?(\d*) @@$/;i<t.length;){var s=t[i].match(n);if(!s)throw Error("Invalid patch string: "+t[i]);var r=new diff_match_patch.patch_obj;for(e.push(r),r.start1=parseInt(s[1],10),""===s[2]?(r.start1--,r.length1=1):"0"==s[2]?r.length1=0:(r.start1--,r.length1=parseInt(s[2],10)),r.start2=parseInt(s[3],10),""===s[4]?(r.start2--,r.length2=1):"0"==s[4]?r.length2=0:(r.start2--,r.length2=parseInt(s[4],10)),i++;i<t.length;){s=t[i].charAt(0);try{var o=decodeURI(t[i].substring(1))}catch(t){throw Error("Illegal escape in patch_fromText: "+o)}if("-"==s)r.diffs.push([DIFF_DELETE,o]);else if("+"==s)r.diffs.push([DIFF_INSERT,o]);else if(" "==s)r.diffs.push([DIFF_EQUAL,o]);else{if("@"==s)break;if(""!==s)throw Error('Invalid patch mode "'+s+'" in: '+o)}i++}}return e},diff_match_patch.patch_obj=function(){this.diffs=[],this.start2=this.start1=null,this.length2=this.length1=0},diff_match_patch.patch_obj.prototype.toString=function(){for(var t,e=["@@ -"+(0===this.length1?this.start1+",0":1==this.length1?this.start1+1:this.start1+1+","+this.length1)+" +"+(0===this.length2?this.start2+",0":1==this.length2?this.start2+1:this.start2+1+","+this.length2)+" @@\n"],i=0;i<this.diffs.length;i++){switch(this.diffs[i][0]){case DIFF_INSERT:t="+";break;case DIFF_DELETE:t="-";break;case DIFF_EQUAL:t=" "}e[i+1]=t+encodeURI(this.diffs[i][1])+"\n"}return e.join("").replace(/%20/g," ")},this.diff_match_patch=diff_match_patch,this.DIFF_DELETE=DIFF_DELETE,this.DIFF_INSERT=DIFF_INSERT,this.DIFF_EQUAL=DIFF_EQUAL,JSON||(JSON={}),function(){function a(t,i){var n,s,r,o,h,u=f,p=i[t];switch(p&&"object"==typeof p&&"function"==typeof p.toJSON&&(p=p.toJSON(t)),"function"==typeof l&&(p=l.call(i,t,p)),typeof p){case"string":return c(p);case"number":return isFinite(p)?String(p):"null";case"boolean":case"null":return String(p);case"object":if(!p)return"null";if(f+=e,h=[],"[object Array]"===Object.prototype.toString.apply(p)){for(o=p.length,n=0;n<o;n+=1)h[n]=a(n,p)||"null";return r=0===h.length?"[]":f?"[\n"+f+h.join(",\n"+f)+"\n"+u+"]":"["+h.join(",")+"]",f=u,r}if(l&&"object"==typeof l)for(o=l.length,n=0;n<o;n+=1)"string"==typeof l[n]&&((r=a(s=l[n],p))&&h.push(c(s)+(f?": ":":")+r));else for(s in p)Object.prototype.hasOwnProperty.call(p,s)&&((r=a(s,p))&&h.push(c(s)+(f?": ":":")+r));return r=0===h.length?"{}":f?"{\n"+f+h.join(",\n"+f)+"\n"+u+"}":"{"+h.join(",")+"}",f=u,r}}function c(t){return h.lastIndex=0,h.test(t)?'"'+t.replace(h,function(t){var e=g[t];return"string"==typeof e?e:"\\u"+("0000"+t.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+t+'"'}function b(t){return t<10?"0"+t:t}"function"!=typeof Date.prototype.toJSON&&(Date.prototype.toJSON=function(t){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+b(this.getUTCMonth()+1)+"-"+b(this.getUTCDate())+"T"+b(this.getUTCHours())+":"+b(this.getUTCMinutes())+":"+b(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(t){return this.valueOf()});var d=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,h=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,f,e,g={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},l;"function"!=typeof JSON.stringify&&(JSON.stringify=function(t,i,n){var s;if(e=f="","number"==typeof n)for(s=0;s<n;s+=1)e+=" ";else"string"==typeof n&&(e=n);if(!(l=i)||"function"==typeof i||"object"==typeof i&&"number"==typeof i.length)return a("",{"":t});throw Error("JSON.stringify")}),"function"!=typeof JSON.parse&&(JSON.parse=function(a,b){function e(t,i){var n,s,r=t[i];if(r&&"object"==typeof r)for(n in r)Object.prototype.hasOwnProperty.call(r,n)&&(void 0!==(s=e(r,n))?r[n]=s:delete r[n]);return b.call(t,i,r)}var c;if(a=String(a),d.lastIndex=0,d.test(a)&&(a=a.replace(d,function(t){return"\\u"+("0000"+t.charCodeAt(0).toString(16)).slice(-4)})),/^[\],:{}\s]*$/.test(a.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return c=eval("("+a+")"),"function"==typeof b?e({"":c},""):c;throw new SyntaxError("JSON.parse")})}(),SockJS=function(){var f=document,l=window,c={},t=function(){};t.prototype.addEventListener=function(t,e){this._listeners||(this._listeners={}),t in this._listeners||(this._listeners[t]=[]);var i=this._listeners[t];-1===c.arrIndexOf(i,e)&&i.push(e)},t.prototype.removeEventListener=function(t,e){if(this._listeners&&t in this._listeners){var i=this._listeners[t],n=c.arrIndexOf(i,e);-1!==n&&(1<i.length?this._listeners[t]=i.slice(0,n).concat(i.slice(n+1)):delete this._listeners[t])}},t.prototype.dispatchEvent=function(t){var e=t.type,i=Array.prototype.slice.call(arguments,0);if(this["on"+e]&&this["on"+e].apply(this,i),this._listeners&&e in this._listeners)for(var n=0;n<this._listeners[e].length;n++)this._listeners[e][n].apply(this,i)};var o=function(t,e){if(this.type=t,void 0!==e)for(var i in e)e.hasOwnProperty(i)&&(this[i]=e[i])};o.prototype.toString=function(){var t,e=[];for(t in this)if(this.hasOwnProperty(t)){var i=this[t];"function"==typeof i&&(i="[function]"),e.push(t+"="+i)}return"SimpleEvent("+e.join(", ")+")"};var e=function(t){this._events=t||[],this._listeners={}};e.prototype.emit=function(t){if(this._verifyType(t),!this._nuked){var e=Array.prototype.slice.call(arguments,1);if(this["on"+t]&&this["on"+t].apply(this,e),t in this._listeners)for(var i=0;i<this._listeners[t].length;i++)this._listeners[t][i].apply(this,e)}},e.prototype.on=function(t,e){this._verifyType(t),this._nuked||(t in this._listeners||(this._listeners[t]=[]),this._listeners[t].push(e))},e.prototype._verifyType=function(t){-1===c.arrIndexOf(this._events,t)&&c.log("Event "+JSON.stringify(t)+" not listed "+JSON.stringify(this._events)+" in "+this)},e.prototype.nuke=function(){this._nuked=!0;for(var t=0;t<this._events.length;t++)delete this[this._events[t]];this._listeners={}},c.random_string=function(t,e){e=e||37;var i,n=[];for(i=0;i<t;i++)n.push("abcdefghijklmnopqrstuvwxyz0123456789_".substr(Math.floor(Math.random()*e),1));return n.join("")},c.random_number=function(t){return Math.floor(Math.random()*t)},c.random_number_string=function(t){var e=(""+(t-1)).length;return(Array(e+1).join("0")+c.random_number(t)).slice(-e)},c.getOrigin=function(t){return(t+"/").split("/").slice(0,3).join("/")},c.isSameOriginUrl=function(t,e){return e||(e=l.location.href),t.split("/").slice(0,3).join("/")===e.split("/").slice(0,3).join("/")},c.getParentDomain=function(t){return/^[0-9.]*$/.test(t)||/^\[/.test(t)||!/[.]/.test(t)?t:t.split(".").slice(1).join(".")},c.objectExtend=function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);return t},c.polluteGlobalNamespace=function(){"_jp"in l||(l._jp={})},c.closeFrame=function(t,e){return"c"+JSON.stringify([t,e])},c.userSetCode=function(t){return 1e3===t||3e3<=t&&t<=4999},c.countRTO=function(t){return 100<t?3*t:t+200},c.log=function(){l.console&&console.log&&console.log.apply&&console.log.apply(console,arguments)},c.bind=function(t,e){return t.bind?t.bind(e):function(){return t.apply(e,arguments)}},c.flatUrl=function(t){return-1===t.indexOf("?")&&-1===t.indexOf("#")},c.amendUrl=function(t){var e=f.location;if(!t)throw Error("Wrong url for SockJS");if(!c.flatUrl(t))throw Error("Only basic urls are supported in SockJS");return 0===t.indexOf("//")&&(t=e.protocol+t),0===t.indexOf("/")&&(t=e.protocol+"//"+e.host+t),t.replace(/[/]+$/,"")},c.arrIndexOf=function(t,e){for(var i=0;i<t.length;i++)if(t[i]===e)return i;return-1},c.arrSkip=function(t,e){var i=c.arrIndexOf(t,e);return-1===i?t.slice():t.slice(0,i).concat(t.slice(i+1))},c.isArray=Array.isArray||function(t){return 0<={}.toString.call(t).indexOf("Array")},c.delay=function(t,e){return"function"==typeof t&&(e=t,t=0),setTimeout(e,t)};var i,n=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,s={"\0":"\\u0000","":"\\u0001","":"\\u0002","":"\\u0003","":"\\u0004","":"\\u0005","":"\\u0006","":"\\u0007","\b":"\\b","\t":"\\t","\n":"\\n","\v":"\\u000b","\f":"\\f","\r":"\\r","":"\\u000e","":"\\u000f","":"\\u0010","":"\\u0011","":"\\u0012","":"\\u0013","":"\\u0014","":"\\u0015","":"\\u0016","":"\\u0017","":"\\u0018","":"\\u0019","":"\\u001a","":"\\u001b","":"\\u001c","":"\\u001d","":"\\u001e","":"\\u001f",'"':'\\"',"\\":"\\\\","":"\\u007f","Â€":"\\u0080","Â":"\\u0081","Â‚":"\\u0082","Âƒ":"\\u0083","Â„":"\\u0084","Â…":"\\u0085","Â†":"\\u0086","Â‡":"\\u0087","Âˆ":"\\u0088","Â‰":"\\u0089","ÂŠ":"\\u008a","Â‹":"\\u008b","ÂŒ":"\\u008c","Â":"\\u008d","ÂŽ":"\\u008e","Â":"\\u008f","Â":"\\u0090","Â‘":"\\u0091","Â’":"\\u0092","Â“":"\\u0093","Â”":"\\u0094","Â•":"\\u0095","Â–":"\\u0096","Â—":"\\u0097","Â˜":"\\u0098","Â™":"\\u0099","Âš":"\\u009a","Â›":"\\u009b","Âœ":"\\u009c","Â":"\\u009d","Âž":"\\u009e","ÂŸ":"\\u009f","Â­":"\\u00ad","Ø€":"\\u0600","Ø":"\\u0601","Ø‚":"\\u0602","Øƒ":"\\u0603","Ø„":"\\u0604","Ü":"\\u070f","áž´":"\\u17b4","ážµ":"\\u17b5","â€Œ":"\\u200c","â€":"\\u200d","â€Ž":"\\u200e","â€":"\\u200f","\u2028":"\\u2028","\u2029":"\\u2029","â€ª":"\\u202a","â€«":"\\u202b","â€¬":"\\u202c","â€­":"\\u202d","â€®":"\\u202e","â€¯":"\\u202f","â ":"\\u2060","â¡":"\\u2061","â¢":"\\u2062","â£":"\\u2063","â¤":"\\u2064","â¥":"\\u2065","â¦":"\\u2066","â§":"\\u2067","â¨":"\\u2068","â©":"\\u2069","âª":"\\u206a","â«":"\\u206b","â¬":"\\u206c","â­":"\\u206d","â®":"\\u206e","â¯":"\\u206f","\ufeff":"\\ufeff","ï¿°":"\\ufff0","ï¿±":"\\ufff1","ï¿²":"\\ufff2","ï¿³":"\\ufff3","ï¿´":"\\ufff4","ï¿µ":"\\ufff5","ï¿¶":"\\ufff6","ï¿·":"\\ufff7","ï¿¸":"\\ufff8","ï¿¹":"\\ufff9","ï¿º":"\\ufffa","ï¿»":"\\ufffb","ï¿¼":"\\ufffc","ï¿½":"\\ufffd","ï¿¾":"\\ufffe","ï¿¿":"\\uffff"},r=/[\x00-\x1f\ud800-\udfff\ufffe\uffff\u0300-\u0333\u033d-\u0346\u034a-\u034c\u0350-\u0352\u0357-\u0358\u035c-\u0362\u0374\u037e\u0387\u0591-\u05af\u05c4\u0610-\u0617\u0653-\u0654\u0657-\u065b\u065d-\u065e\u06df-\u06e2\u06eb-\u06ec\u0730\u0732-\u0733\u0735-\u0736\u073a\u073d\u073f-\u0741\u0743\u0745\u0747\u07eb-\u07f1\u0951\u0958-\u095f\u09dc-\u09dd\u09df\u0a33\u0a36\u0a59-\u0a5b\u0a5e\u0b5c-\u0b5d\u0e38-\u0e39\u0f43\u0f4d\u0f52\u0f57\u0f5c\u0f69\u0f72-\u0f76\u0f78\u0f80-\u0f83\u0f93\u0f9d\u0fa2\u0fa7\u0fac\u0fb9\u1939-\u193a\u1a17\u1b6b\u1cda-\u1cdb\u1dc0-\u1dcf\u1dfc\u1dfe\u1f71\u1f73\u1f75\u1f77\u1f79\u1f7b\u1f7d\u1fbb\u1fbe\u1fc9\u1fcb\u1fd3\u1fdb\u1fe3\u1feb\u1fee-\u1fef\u1ff9\u1ffb\u1ffd\u2000-\u2001\u20d0-\u20d1\u20d4-\u20d7\u20e7-\u20e9\u2126\u212a-\u212b\u2329-\u232a\u2adc\u302b-\u302c\uaab2-\uaab3\uf900-\ufa0d\ufa10\ufa12\ufa15-\ufa1e\ufa20\ufa22\ufa25-\ufa26\ufa2a-\ufa2d\ufa30-\ufa6d\ufa70-\ufad9\ufb1d\ufb1f\ufb2a-\ufb36\ufb38-\ufb3c\ufb3e\ufb40-\ufb41\ufb43-\ufb44\ufb46-\ufb4e\ufff0-\uffff]/g,a=JSON&&JSON.stringify||function(t){return n.lastIndex=0,n.test(t)&&(t=t.replace(n,function(t){return s[t]})),'"'+t+'"'};c.quote=function(t){return t=a(t),r.lastIndex=0,r.test(t)?(i||(i=function(t){var e,i={},n=[];for(e=0;e<65536;e++)n.push(String.fromCharCode(e));return t.lastIndex=0,n.join("").replace(t,function(t){return i[t]="\\u"+("0000"+t.charCodeAt(0).toString(16)).slice(-4),""}),t.lastIndex=0,i}(r)),t.replace(r,function(t){return i[t]})):t};var h="websocket xdr-streaming xhr-streaming iframe-eventsource iframe-htmlfile xdr-polling xhr-polling iframe-xhr-polling jsonp-polling".split(" ");c.probeProtocols=function(){for(var t={},e=0;e<h.length;e++){var i=h[e];t[i]=_[i]&&_[i].enabled()}return t},c.detectProtocols=function(t,e,i){var n={},s=[];e||(e=h);for(var r=0;r<e.length;r++){var o=e[r];n[o]=t[o]}var a=function(t){var e=t.shift();n[e]?s.push(e):0<t.length&&a(t)};return!1!==i.websocket&&a(["websocket"]),n["xhr-streaming"]&&!i.null_origin?s.push("xhr-streaming"):!n["xdr-streaming"]||i.cookie_needed||i.null_origin?a(["iframe-eventsource","iframe-htmlfile"]):s.push("xdr-streaming"),n["xhr-polling"]&&!i.null_origin?s.push("xhr-polling"):!n["xdr-polling"]||i.cookie_needed||i.null_origin?a(["iframe-xhr-polling","jsonp-polling"]):s.push("xdr-polling"),s},c.createHook=function(){var t="a"+c.random_string(8);if(!("_sockjs_global"in l)){var e={};l._sockjs_global=function(t){return t in e||(e[t]={id:t,del:function(){delete e[t]}}),e[t]}}return l._sockjs_global(t)},c.attachMessage=function(t){c.attachEvent("message",t)},c.attachEvent=function(t,e){void 0!==l.addEventListener?l.addEventListener(t,e,!1):(f.attachEvent("on"+t,e),l.attachEvent("on"+t,e))},c.detachMessage=function(t){c.detachEvent("message",t)},c.detachEvent=function(t,e){void 0!==l.addEventListener?l.removeEventListener(t,e,!1):(f.detachEvent("on"+t,e),l.detachEvent("on"+t,e))};var u={},p=!1,d=function(){for(var t in u)u[t](),delete u[t]};c.attachEvent("unload",function(){p||(p=!0,d())}),c.unload_add=function(t){var e=c.random_string(8);return u[e]=t,p&&c.delay(d),e},c.unload_del=function(t){t in u&&delete u[t]},c.createIframe=function(t,e){var i,n,s=f.createElement("iframe"),r=function(){clearTimeout(i);try{s.onload=null}catch(t){}s.onerror=null},o=function(){s&&(r(),setTimeout(function(){s&&s.parentNode.removeChild(s),s=null},0),c.unload_del(n))},a=function(t){s&&(o(),e(t))};return s.src=t,s.style.display="none",s.style.position="absolute",s.onerror=function(){a("onerror")},s.onload=function(){clearTimeout(i),i=setTimeout(function(){a("onload timeout")},2e3)},f.body.appendChild(s),i=setTimeout(function(){a("timeout")},15e3),n=c.unload_add(o),{post:function(t,e){try{s&&s.contentWindow&&s.contentWindow.postMessage(t,e)}catch(t){}},cleanup:o,loaded:r}},c.createHtmlfile=function(t,e){var i,n,s,r=new ActiveXObject("htmlfile"),o=function(){clearTimeout(i)},a=function(){r&&(o(),c.unload_del(n),s.parentNode.removeChild(s),s=r=null,CollectGarbage())};r.open(),r.write('<html><script>document.domain="'+document.domain+'";<\/script></html>'),r.close(),r.parentWindow._jp=l._jp;var h=r.createElement("div");return r.body.appendChild(h),s=r.createElement("iframe"),h.appendChild(s),s.src=t,i=setTimeout(function(){r&&(a(),e("timeout"))},15e3),n=c.unload_add(a),{post:function(t,e){try{s&&s.contentWindow&&s.contentWindow.postMessage(t,e)}catch(t){}},cleanup:a,loaded:o}},(y=function(){}).prototype=new e(["chunk","finish"]),y.prototype._start=function(t,e,i,n){var s=this;try{s.xhr=new XMLHttpRequest}catch(t){}if(!s.xhr)try{s.xhr=new l.ActiveXObject("Microsoft.XMLHTTP")}catch(t){}(l.ActiveXObject||l.XDomainRequest)&&(e+=(-1===e.indexOf("?")?"?":"&")+"t="+ +new Date),s.unload_ref=c.unload_add(function(){s._cleanup(!0)});try{s.xhr.open(t,e,!0)}catch(t){return s.emit("finish",0,""),void s._cleanup()}if(n&&n.no_credentials||(s.xhr.withCredentials="true"),n&&n.headers)for(var r in n.headers)s.xhr.setRequestHeader(r,n.headers[r]);s.xhr.onreadystatechange=function(){if(s.xhr){var t=s.xhr;switch(t.readyState){case 3:try{var e=t.status,i=t.responseText}catch(t){}1223===e&&(e=204),i&&0<i.length&&s.emit("chunk",e,i);break;case 4:1223===(e=t.status)&&(e=204),s.emit("finish",e,t.responseText),s._cleanup(!1)}}},s.xhr.send(i)},y.prototype._cleanup=function(t){if(this.xhr){if(c.unload_del(this.unload_ref),this.xhr.onreadystatechange=function(){},t)try{this.xhr.abort()}catch(t){}this.unload_ref=this.xhr=null}},y.prototype.close=function(){this.nuke(),this._cleanup(!0)},(c.XHRCorsObject=function(){var t=this,e=arguments;c.delay(function(){t._start.apply(t,e)})}).prototype=new y,(c.XHRLocalObject=function(t,e,i){var n=this;c.delay(function(){n._start(t,e,i,{no_credentials:!0})})}).prototype=new y,(y=c.XDRObject=function(t,e,i){var n=this;c.delay(function(){n._start(t,e,i)})}).prototype=new e(["chunk","finish"]),y.prototype._start=function(t,e,i){var n=this,s=new XDomainRequest;e+=(-1===e.indexOf("?")?"?":"&")+"t="+ +new Date;var r=s.ontimeout=s.onerror=function(){n.emit("finish",0,""),n._cleanup(!1)};s.onprogress=function(){n.emit("chunk",200,s.responseText)},s.onload=function(){n.emit("finish",200,s.responseText),n._cleanup(!1)},n.xdr=s,n.unload_ref=c.unload_add(function(){n._cleanup(!0)});try{n.xdr.open(t,e),n.xdr.send(i)}catch(t){r()}},y.prototype._cleanup=function(t){if(this.xdr){if(c.unload_del(this.unload_ref),this.xdr.ontimeout=this.xdr.onerror=this.xdr.onprogress=this.xdr.onload=null,t)try{this.xdr.abort()}catch(t){}this.unload_ref=this.xdr=null}},y.prototype.close=function(){this.nuke(),this._cleanup(!0)},c.isXHRCorsCapable=function(){return l.XMLHttpRequest&&"withCredentials"in new XMLHttpRequest?1:l.XDomainRequest&&f.domain?2:k.enabled()?3:4};var _=function(t,e,i){if(this===l)return new _(t,e,i);var n,s=this;s._options={devel:!1,debug:!1,protocols_whitelist:[],info:void 0,rtt:void 0},i&&c.objectExtend(s._options,i),s._base_url=c.amendUrl(t),s._server=s._options.server||c.random_number_string(1e3),s._options.protocols_whitelist&&s._options.protocols_whitelist.length?n=s._options.protocols_whitelist:(n="string"==typeof e&&0<e.length?[e]:c.isArray(e)?e:null)&&s._debug('Deprecated API: Use "protocols_whitelist" option instead of supplying protocol list as a second parameter to SockJS constructor.'),s._protocols=[],s.protocol=null,s.readyState=_.CONNECTING,s._ir=T(s._base_url),s._ir.onfinish=function(t,e){s._ir=null,t?(s._options.info&&(t=c.objectExtend(t,s._options.info)),s._options.rtt&&(e=s._options.rtt),s._applyInfo(t,e,n),s._didClose()):s._didClose(1002,"Can't connect to server",!0)}};_.prototype=new t,_.version="0.3.4",_.CONNECTING=0,_.OPEN=1,_.CLOSING=2,_.CLOSED=3,_.prototype._debug=function(){this._options.debug&&c.log.apply(c,arguments)},_.prototype._dispatchOpen=function(){this.readyState===_.CONNECTING?(this._transport_tref&&(clearTimeout(this._transport_tref),this._transport_tref=null),this.readyState=_.OPEN,this.dispatchEvent(new o("open"))):this._didClose(1006,"Server lost session")},_.prototype._dispatchMessage=function(t){this.readyState===_.OPEN&&this.dispatchEvent(new o("message",{data:t}))},_.prototype._dispatchHeartbeat=function(t){this.readyState===_.OPEN&&this.dispatchEvent(new o("heartbeat",{}))},_.prototype._didClose=function(t,e,i){var n=this;if(n.readyState!==_.CONNECTING&&n.readyState!==_.OPEN&&n.readyState!==_.CLOSING)throw Error("INVALID_STATE_ERR");n._ir&&(n._ir.nuke(),n._ir=null),n._transport&&(n._transport.doCleanup(),n._transport=null);var s=new o("close",{code:t,reason:e,wasClean:c.userSetCode(t)});if(!c.userSetCode(t)&&n.readyState===_.CONNECTING&&!i){if(n._try_next_protocol(s))return;s=new o("close",{code:2e3,reason:"All transports failed",wasClean:!1,last_event:s})}n.readyState=_.CLOSED,c.delay(function(){n.dispatchEvent(s)})},_.prototype._didMessage=function(t){switch(t.slice(0,1)){case"o":this._dispatchOpen();break;case"a":t=JSON.parse(t.slice(1)||"[]");for(var e=0;e<t.length;e++)this._dispatchMessage(t[e]);break;case"m":t=JSON.parse(t.slice(1)||"null"),this._dispatchMessage(t);break;case"c":t=JSON.parse(t.slice(1)||"[]"),this._didClose(t[0],t[1]);break;case"h":this._dispatchHeartbeat()}},_.prototype._try_next_protocol=function(t){var e=this;for(e.protocol&&(e._debug("Closed transport:",e.protocol,""+t),e.protocol=null),e._transport_tref&&(clearTimeout(e._transport_tref),e._transport_tref=null);;){if(!(t=e.protocol=e._protocols.shift()))return!1;if(_[t]&&!0===_[t].need_body&&(!f.body||void 0!==f.readyState&&"complete"!==f.readyState))return e._protocols.unshift(t),e.protocol="waiting-for-load",c.attachEvent("load",function(){e._try_next_protocol()}),!0;if(_[t]&&_[t].enabled(e._options)){e._transport_tref=c.delay((e._options.rto||0)*(_[t].roundTrips||1)||5e3,function(){e.readyState===_.CONNECTING&&e._didClose(2007,"Transport timeouted")});var i=c.random_string(8);i=e._base_url+"/"+e._server+"/"+i;return e._debug("Opening transport:",t," url:"+i," RTO:"+e._options.rto),e._transport=new _[t](e,i,e._base_url),!0}e._debug("Skipping transport:",t)}},_.prototype.close=function(t,e){if(t&&!c.userSetCode(t))throw Error("INVALID_ACCESS_ERR");return(this.readyState===_.CONNECTING||this.readyState===_.OPEN)&&(this.readyState=_.CLOSING,this._didClose(t||1e3,e||"Normal closure"),!0)},_.prototype.send=function(t){if(this.readyState===_.CONNECTING)throw Error("INVALID_STATE_ERR");return this.readyState===_.OPEN&&this._transport.doSend(c.quote(""+t)),!0},_.prototype._applyInfo=function(t,e,i){this._options.info=t,this._options.rtt=e,this._options.rto=c.countRTO(e),this._options.info.null_origin=!f.domain,e=c.probeProtocols(),this._protocols=c.detectProtocols(e,i,t)},(y=_.websocket=function(t,e){var i=this,n="https"===(n=e+"/websocket").slice(0,5)?"wss"+n.slice(5):"ws"+n.slice(4);i.ri=t,i.url=n,i.ws=new(l.WebSocket||l.MozWebSocket)(i.url),i.ws.onmessage=function(t){i.ri._didMessage(t.data)},i.unload_ref=c.unload_add(function(){i.ws.close()}),i.ws.onclose=function(){i.ri._didMessage(c.closeFrame(1006,"WebSocket connection broken"))}}).prototype.doSend=function(t){this.ws.send("["+t+"]")},y.prototype.doCleanup=function(){var t=this.ws;t&&(t.onmessage=t.onclose=null,t.close(),c.unload_del(this.unload_ref),this.unload_ref=this.ri=this.ws=null)},y.enabled=function(){return!(!l.WebSocket&&!l.MozWebSocket)},y.roundTrips=2;var g=function(){};g.prototype.send_constructor=function(t){this.send_buffer=[],this.sender=t},g.prototype.doSend=function(t){this.send_buffer.push(t),this.send_stop||this.send_schedule()},g.prototype.send_schedule_wait=function(){var t,e=this;e.send_stop=function(){e.send_stop=null,clearTimeout(t)},t=c.delay(25,function(){e.send_stop=null,e.send_schedule()})},g.prototype.send_schedule=function(){var i=this;if(0<i.send_buffer.length){var t="["+i.send_buffer.join(",")+"]";i.send_stop=i.sender(i.trans_url,t,function(t,e){i.send_stop=null,!1===t?i.ri._didClose(1006,"Sending error "+e):i.send_schedule_wait()}),i.send_buffer=[]}},g.prototype.send_destructor=function(){this._send_stop&&this._send_stop(),this._send_stop=null};var m=function(t,e,i){if(!("_send_form"in this)){var n=this._send_form=f.createElement("form");(r=this._send_area=f.createElement("textarea")).name="d",n.style.display="none",n.style.position="absolute",n.method="POST",n.enctype="application/x-www-form-urlencoded",n.acceptCharset="UTF-8",n.appendChild(r),f.body.appendChild(n)}n=this._send_form;var s,r=this._send_area,o="a"+c.random_string(8);n.target=o,n.action=t+"/jsonp_send?i="+o;try{s=f.createElement('<iframe name="'+o+'">')}catch(t){(s=f.createElement("iframe")).name=o}s.id=o,n.appendChild(s),s.style.display="none";try{r.value=e}catch(t){c.log("Your browser is seriously broken. Go home! "+t.message)}n.submit();var a=function(t){s.onerror&&(s.onreadystatechange=s.onerror=s.onload=null,c.delay(500,function(){s.parentNode.removeChild(s),s=null}),r.value="",i(!0))};return s.onerror=s.onload=a,s.onreadystatechange=function(t){"complete"==s.readyState&&a()},a},b=function(t,e){var i,n,s=f.createElement("script"),r=function(t){n&&(n.parentNode.removeChild(n),n=null),s&&(clearTimeout(i),s.parentNode.removeChild(s),s=s.onreadystatechange=s.onerror=s.onload=s.onclick=null,e(t),e=null)},o=!1,a=null;if(s.id="a"+c.random_string(8),s.src=t,s.type="text/javascript",s.charset="UTF-8",s.onerror=function(t){a||(a=setTimeout(function(){o||r(c.closeFrame(1006,"JSONP script loaded abnormally (onerror)"))},1e3))},s.onload=function(t){r(c.closeFrame(1006,"JSONP script loaded abnormally (onload)"))},s.onreadystatechange=function(t){if(/loaded|closed/.test(s.readyState)){if(s&&s.htmlFor&&s.onclick){o=!0;try{s.onclick()}catch(t){}}s&&r(c.closeFrame(1006,"JSONP script loaded abnormally (onreadystatechange)"))}},void 0===s.async&&f.attachEvent)if(/opera/i.test(navigator.userAgent))(n=f.createElement("script")).text="try{var a = document.getElementById('"+s.id+"'); if(a)a.onerror();}catch(x){};",s.async=n.async=!1;else{try{s.htmlFor=s.id,s.event="onclick"}catch(t){}s.async=!0}void 0!==s.async&&(s.async=!0),i=setTimeout(function(){r(c.closeFrame(1006,"JSONP script loaded abnormally (timeout)"))},35e3);var h=f.getElementsByTagName("head")[0];return h.insertBefore(s,h.firstChild),n&&h.insertBefore(n,h.firstChild),r};(y=_["jsonp-polling"]=function(t,e){c.polluteGlobalNamespace(),this.ri=t,this.trans_url=e,this.send_constructor(m),this._schedule_recv()}).prototype=new g,y.prototype._schedule_recv=function(){var e=this;e._recv_stop=v(e.trans_url+"/jsonp",b,function(t){e._recv_stop=null,t&&(e._is_closing||e.ri._didMessage(t)),e._is_closing||e._schedule_recv()})},y.enabled=function(){return!0},y.need_body=!0,y.prototype.doCleanup=function(){this._is_closing=!0,this._recv_stop&&this._recv_stop(),this.ri=this._recv_stop=null,this.send_destructor()};var y,v=function(t,e,i){var n="a"+c.random_string(6);t=t+"?c="+escape("_jp."+n);var s=0;return e=e(t,function(t){switch(s){case 0:delete l._jp[n],i(t);break;case 1:i(t),s=2;break;case 2:delete l._jp[n]}}),l._jp[n]=e,function(){l._jp[n]&&(s=1,l._jp[n](c.closeFrame(1e3,"JSONP user aborted read")))}};(y=function(){}).prototype=new g,y.prototype.run=function(t,e,i,n,s){var r;this.ri=t,this.trans_url=e,this.send_constructor((r=s,function(t,e,i){return new r("POST",t+"/xhr_send",e).onfinish=function(t,e){i(200===t||204===t,"http status "+t)},function(t){i(!1,t)}})),this.poll=new j(t,n,e+i,s)},y.prototype.doCleanup=function(){this.poll&&(this.poll.abort(),this.poll=null)};var x=_["xhr-streaming"]=function(t,e){this.run(t,e,"/xhr_streaming",L,c.XHRCorsObject)};x.prototype=new y,x.enabled=function(){return l.XMLHttpRequest&&"withCredentials"in new XMLHttpRequest&&!/opera/i.test(navigator.userAgent)},x.roundTrips=2,x.need_body=!0,(g=_["xdr-streaming"]=function(t,e){this.run(t,e,"/xhr_streaming",L,c.XDRObject)}).prototype=new y,g.enabled=function(){return!!l.XDomainRequest},g.roundTrips=2;var E=_["xhr-polling"]=function(t,e){this.run(t,e,"/xhr",L,c.XHRCorsObject)};E.prototype=new y,E.enabled=x.enabled,E.roundTrips=2,(x=_["xdr-polling"]=function(t,e){this.run(t,e,"/xhr",L,c.XDRObject)}).prototype=new y,x.enabled=g.enabled,x.roundTrips=2;var k=function(){};k.prototype.i_constructor=function(t,e,i){var n=this;n.ri=t,n.origin=c.getOrigin(i),n.base_url=i,n.trans_url=e,t=i+"/iframe.html",n.ri._options.devel&&(t+="?t="+ +new Date),n.window_id=c.random_string(8),t+="#"+n.window_id,n.iframeObj=c.createIframe(t,function(t){n.ri._didClose(1006,"Unable to load an iframe ("+t+")")}),n.onmessage_cb=c.bind(n.onmessage,n),c.attachMessage(n.onmessage_cb)},k.prototype.doCleanup=function(){if(this.iframeObj){c.detachMessage(this.onmessage_cb);try{this.iframeObj.iframe.contentWindow&&this.postMessage("c")}catch(t){}this.iframeObj.cleanup(),this.onmessage_cb=this.iframeObj=this.iframeObj=null}},k.prototype.onmessage=function(t){if(t.origin===this.origin){var e=t.data.slice(0,8),i=t.data.slice(8,9);if(t=t.data.slice(9),e===this.window_id)switch(i){case"s":this.iframeObj.loaded(),this.postMessage("s",JSON.stringify([_.version,this.protocol,this.trans_url,this.base_url]));break;case"t":this.ri._didMessage(t)}}},k.prototype.postMessage=function(t,e){this.iframeObj.post(this.window_id+t+(e||""),this.origin)},k.prototype.doSend=function(t){this.postMessage("m",t)},k.enabled=function(){var t=navigator&&navigator.userAgent&&-1!==navigator.userAgent.indexOf("Konqueror");return("function"==typeof l.postMessage||"object"==typeof l.postMessage)&&!t};var w,S=function(t,e){parent!==l?parent.postMessage(w+t+(e||""),"*"):c.log("Can't postMessage, no parent window.",t,e)},F=function(){};F.prototype._didClose=function(t,e){S("t",c.closeFrame(t,e))},F.prototype._didMessage=function(t){S("t",t)},F.prototype._doSend=function(t){this._transport.doSend(t)},F.prototype._doCleanup=function(){this._transport.doCleanup()},c.parent_origin=void 0,_.bootstrap_iframe=function(){var s;w=f.location.hash.slice(1),c.attachMessage(function(t){if(t.source===parent&&(void 0===c.parent_origin&&(c.parent_origin=t.origin),t.origin===c.parent_origin)){var e=t.data.slice(0,8),i=t.data.slice(8,9);if(t=t.data.slice(9),e===w)switch(i){case"s":var n=JSON.parse(t);e=n[0],i=n[1];if(t=n[2],n=n[3],e!==_.version&&c.log('Incompatibile SockJS! Main site uses: "'+e+'", the iframe: "'+_.version+'".'),!c.flatUrl(t)||!c.flatUrl(n)){c.log("Only basic urls are supported in SockJS");break}if(!c.isSameOriginUrl(t)||!c.isSameOriginUrl(n)){c.log("Can't connect to different domain from within an iframe. ("+JSON.stringify([l.location.href,t,n])+")");break}(s=new F)._transport=new F[i](s,t,n);break;case"m":s._doSend(t);break;case"c":s&&s._doCleanup(),s=null}}}),S("s")};var I=function(t,e){var i=this;c.delay(function(){i.doXhr(t,e)})};(I.prototype=new e(["finish"])).doXhr=function(t,e){var s=this,r=(new Date).getTime(),i=new e("GET",t+"/info"),o=c.delay(8e3,function(){i.ontimeout()});i.onfinish=function(t,e){if(clearTimeout(o),o=null,200===t){var i=(new Date).getTime()-r,n=JSON.parse(e);"object"!=typeof n&&(n={}),s.emit("finish",n,i)}else s.emit("finish")},i.ontimeout=function(){i.close(),s.emit("finish")}};var D=function(i){var n=this,t=function(){var e=new k;e.protocol="w-iframe-info-receiver";var t=function(t){"string"==typeof t&&"m"===t.substr(0,1)?(t=JSON.parse(t.substr(1)),n.emit("finish",t[0],t[1])):n.emit("finish"),e.doCleanup(),e=null};e.i_constructor({_options:{},_didClose:t,_didMessage:t},i,i)};f.body?t():c.attachEvent("load",t)};D.prototype=new e(["finish"]);var O=function(){var t=this;c.delay(function(){t.emit("finish",{},2e3)})};O.prototype=new e(["finish"]);var T=function(t){if(c.isSameOriginUrl(t))return new I(t,c.XHRLocalObject);switch(c.isXHRCorsCapable()){case 1:return new I(t,c.XHRLocalObject);case 2:return new I(t,c.XDRObject);case 3:return new D(t);default:return new O}};(F["w-iframe-info-receiver"]=function(i,t,e){new I(e,c.XHRLocalObject).onfinish=function(t,e){i._didMessage("m"+JSON.stringify([t,e])),i._didClose()}}).prototype.doCleanup=function(){},(e=_["iframe-eventsource"]=function(){this.protocol="w-iframe-eventsource",this.i_constructor.apply(this,arguments)}).prototype=new k,e.enabled=function(){return"EventSource"in l&&k.enabled()},e.need_body=!0,e.roundTrips=3,(F["w-iframe-eventsource"]=function(t,e){this.run(t,e,"/eventsource",M,c.XHRLocalObject)}).prototype=new y,(e=_["iframe-xhr-polling"]=function(){this.protocol="w-iframe-xhr-polling",this.i_constructor.apply(this,arguments)}).prototype=new k,e.enabled=function(){return l.XMLHttpRequest&&k.enabled()},e.need_body=!0,e.roundTrips=3,(F["w-iframe-xhr-polling"]=function(t,e){this.run(t,e,"/xhr",L,c.XHRLocalObject)}).prototype=new y,(e=_["iframe-htmlfile"]=function(){this.protocol="w-iframe-htmlfile",this.i_constructor.apply(this,arguments)}).prototype=new k,e.enabled=function(){return k.enabled()},e.need_body=!0,e.roundTrips=3,(F["w-iframe-htmlfile"]=function(t,e){this.run(t,e,"/htmlfile",N,c.XHRLocalObject)}).prototype=new y;var j=function(t,e,i,n){this.ri=t,this.Receiver=e,this.recv_url=i,this.AjaxObject=n,this._scheduleRecv()};j.prototype._scheduleRecv=function(){var e=this,i=e.poll=new e.Receiver(e.recv_url,e.AjaxObject);i.onmessage=function(t){e.ri._didMessage(t.data)},i.onclose=function(t){e.poll=i=i.onmessage=i.onclose=null,e.poll_is_closing||("permanent"===t.reason?e.ri._didClose(1006,"Polling error ("+t.reason+")"):e._scheduleRecv())}},j.prototype.abort=function(){this.poll_is_closing=!0,this.poll&&this.poll.abort()};var M=function(t){var n=this,s=new EventSource(t);s.onmessage=function(t){n.dispatchEvent(new o("message",{data:unescape(t.data)}))},n.es_close=s.onerror=function(t,e){var i=e?"user":2!==s.readyState?"network":"permanent";n.es_close=s.onmessage=s.onerror=null,s.close(),s=null,c.delay(200,function(){n.dispatchEvent(new o("close",{reason:i}))})}};M.prototype=new t,M.prototype.abort=function(){this.es_close&&this.es_close({},!0)};var C,N=function(t){var i=this;if(c.polluteGlobalNamespace(),i.id="a"+c.random_string(6,26),t+=(-1===t.indexOf("?")?"?":"&")+"c="+escape("_jp."+i.id),void 0===C)if("ActiveXObject"in l)try{C=!!new ActiveXObject("htmlfile")}catch(t){}else C=!1;var n,e=C?c.createHtmlfile:c.createIframe;l._jp[i.id]={start:function(){n.loaded()},message:function(t){i.dispatchEvent(new o("message",{data:t}))},stop:function(){i.iframe_close({},"network")}},i.iframe_close=function(t,e){n.cleanup(),i.iframe_close=n=null,delete l._jp[i.id],i.dispatchEvent(new o("close",{reason:e}))},n=e(t,function(t){i.iframe_close({},"permanent")})};N.prototype=new t,N.prototype.abort=function(){this.iframe_close&&this.iframe_close({},"user")};var L=function(t,e){var s=this,r=0;s.xo=new e("POST",t,null),s.xo.onchunk=function(t,e){if(200===t)for(;;){var i=e.slice(r),n=i.indexOf("\n");if(-1===n)break;r+=n+1,i=i.slice(0,n),s.dispatchEvent(new o("message",{data:i}))}},s.xo.onfinish=function(t,e){s.xo.onchunk(t,e),s.xo=null,s.dispatchEvent(new o("close",{reason:200===t?"network":"permanent"}))}};return L.prototype=new t,L.prototype.abort=function(){this.xo&&(this.xo.close(),this.dispatchEvent(new o("close",{reason:"user"})),this.xo=null)},_.getUtils=function(){return c},_.getIframeTransport=function(){return k},_}(),"_sockjs_onload"in window&&setTimeout(_sockjs_onload,1),"function"==typeof define&&define.amd&&define("sockjs",[],function(){return SockJS}),function(){var n,t,r=function(t,e){return function(){return t.apply(e,arguments)}},o={}.hasOwnProperty,i=[].indexOf||function(t){for(var e=0,i=this.length;e<i;e++)if(e in this&&this[e]===t)return e;return-1};n=function(){function t(t,e,i){for(e in this.s=t,this.name=e,this._check_pending=r(this._check_pending,this),this.pending=r(this.pending,this),this.on_changes=r(this.on_changes,this),this.retrieve_changes=r(this.retrieve_changes,this),this._send_changes=r(this._send_changes,this),this._queue_change=r(this._queue_change,this),this._make_change=r(this._make_change,this),this.update=r(this.update,this),this._check_update=r(this._check_update,this),this._notify_client=r(this._notify_client,this),this._index_loaded=r(this._index_loaded,this),this.on_entity_version=r(this.on_entity_version,this),this.get_version=r(this.get_version,this),this.load_versions=r(this.load_versions,this),this.on_index_error=r(this.on_index_error,this),this.on_index_page=r(this.on_index_page,this),this._refresh_store=r(this._refresh_store,this),this.send=r(this.send,this),this.on_data=r(this.on_data,this),this.start=r(this.start,this),this._remove_entity=r(this._remove_entity,this),this._save_entity=r(this._save_entity,this),this._load_data=r(this._load_data,this),this._verify=r(this._verify,this),this._load_meta=r(this._load_meta,this),this.show_data=r(this.show_data,this),this.on=r(this.on,this),this.jd=this.s.jd,this.options=this.jd.deepCopy(this.s.options),i)o.call(i,e)&&(t=i[e],this.options[e]=t);this.chan=this.options.n,this.space=this.options.app_id+"/"+this.name,this.username=this.options.username,this.namespace=this.username+":"+this.space,this.clientid=null;try{this.clientid=localStorage.getItem(this.namespace+"/clientid")}catch(t){this.clientid=null}if(null==this.clientid||0!==this.clientid.indexOf("sjs")){this.clientid="sjs-"+this.s.bversion+"-"+this.uuid(5);try{localStorage.setItem(this.namespace+"/clientid")}catch(t){}}this.cb_events="notify notify_init notify_version local get ready notify_pending error".split(" "),this.cbs={},this.cb_e=this.cb_l=this.cb_ni=this.cb_np=null,this.cb_n=this.cb_nv=this.cb_r=function(){},this.authorized=this.initialized=!1,this.data={last_cv:0,ccid:this.uuid(),store:{},send_queue:[],send_queue_timer:null},this.started=!1,"nostore"in this.options?this.loaded=0:(this._load_meta(),this.loaded=this._load_data()),this._last_pending=null,this._send_backoff=15e3,this._backoff_max=12e4,this._backoff_min=15e3}return t.prototype.S4=function(){return(65536*(1+Math.random())|0).toString(16).substring(1)},t.prototype.uuid=function(t){var e;for(t=t||8,e=this.S4();t-=1;)e+=this.S4();return e},t.prototype.now=function(){return(new Date).getTime()},t.prototype.on=function(t,e){if(!(0<=i.call(this.cb_events,t)))throw Error("unsupported callback event");switch(this.cbs[t]=e,t){case"get":case"local":return this.cb_l=e;case"notify":return this.cb_n=e;case"notify_version":return this.cb_nv=e;case"notify_pending":return this.cb_np=e;case"notify_init":return this.cb_ni=e;case"ready":return this.cb_r=e;case"error":return this.cb_e=e}},t.prototype.show_data=function(){var t;if(this.s.supports_html5_storage()){for(t in localStorage)o.call(localStorage,t);return!1}},t.prototype._save_meta=function(){if(!this.s.supports_html5_storage())return!1;try{localStorage.setItem(this.namespace+"/ccid",this.data.ccid),localStorage.setItem(this.namespace+"/last_cv",this.data.last_cv)}catch(t){return!1}return!0},t.prototype._load_meta=function(){var t;if(this.s.supports_html5_storage())return this.data.ccid=localStorage.getItem(this.namespace+"/ccid"),null==(t=this.data).ccid&&(t.ccid=1),this.data.last_cv=localStorage.getItem(this.namespace+"/last_cv"),null==(t=this.data).last_cv&&(t.last_cv=0),!1},t.prototype._verify=function(t){if(!("object"in t&&"version"in t))return!1;if(0===this.jd.entries(t.object)){if(!("last"in t&&0<this.jd.entries(t.last)))return!1}else if(null==t.version)return!1;return!0},t.prototype._load_data=function(){var e,t,i,n,s,r,o,a;if(this.s.supports_html5_storage()){if(s=(r=this.namespace+"/e/").length,(n=0)===localStorage.length)return 0;for(t=o=0,a=localStorage.length-1;0<=a?o<=a:a<=o;t=0<=a?++o:--o)if(null!=(i=localStorage.key(t))&&i.substr(0,s)===r){t=i.substr(s,i.length-s);try{e=JSON.parse(localStorage.getItem(i))}catch(t){e=null}null!=e&&(this._verify(e)?(e.check=null,this.data.store[t]=e,n+=1):this._remove_entity(t))}return n}},t.prototype._save_entity=function(t){var e,i;if(!this.s.supports_html5_storage())return!1;i=this.namespace+"/e/"+t,t=this.data.store[t],e=JSON.stringify(t);try{localStorage.setItem(i,e)}catch(t){return!1}return i=JSON.parse(localStorage.getItem(i)),!!this.jd.equals(t,i)},t.prototype._remove_entity=function(t){if(!this.s.supports_html5_storage())return!1;t=this.namespace+"/e/"+t;try{localStorage.removeItem(t)}catch(t){return!1}return!0},t.prototype.start=function(){var t,e;if(this.namespace=this.username+":"+this.space,this.started=!0,this.first=!1,this.authorized){if(this.initialized)return this.retrieve_changes();if(!this.first)return this.notify_index={},this._refresh_store()}else this.s.connected&&(this.first=!0,t="limit"in this.options?"i:1:::"+this.options.limit:"i:1:::40",this.irequest_time=this.now(),this.index_request=!0,this.notify_index={},e={app_id:this.options.app_id,token:this.options.token,name:this.name,clientid:this.clientid,build:this.s.bversion},this.initialized||(e.cmd=t),this.send("init:"+JSON.stringify(e)))},t.prototype.on_data=function(t){var e,i,n,s=this;if("auth:"!==t.substr(0,5))return"cv:?"===t.substr(0,4)?setTimeout(function(){return s._refresh_store()}):"c:"===t.substr(0,2)?(e=JSON.parse(t.substr(2)),"0"!==this.data.last_cv||0!==e.length||this.cv_check||(this.cv_check=!0,this._refresh_store()),this.on_changes(e)):"i:"===t.substr(0,2)?this.on_index_page(JSON.parse(t.substr(2))):"e:"===t.substr(0,2)&&(n=t.indexOf("\n"),e=(i=t.substr(2,n-2)).substr(i.lastIndexOf(".")+1),i=i.substr(0,i.lastIndexOf(".")),"?"===(t=t.substr(n+1))?this.on_entity_version(null,i,e):(t=JSON.parse(t),this.on_entity_version(t.data,i,e)));if("expired"===(e=t.substr(5)))this.started=!1,null!=this.cb_e&&this.cb_e("auth");else if(this.username=e,this.authorized=!0,this.initialized)return this.start()},t.prototype.send=function(t){return this.s.send(this.chan+":"+t)},t.prototype._refresh_store=function(){this.send("limit"in this.options?"i:1:::"+this.options.limit:"i:1:::40"),this.irequest_time=this.now(),this.index_request=!0},t.prototype.on_index_page=function(t){var e,i,n,s,r,o,a,h=this;for(this.now(),s=i=0,r=(o=t.index).length;s<r;s++)e=o[s],this.notify_index[e.id]=!1,i++,setTimeout(function(t){return function(){return h.on_entity_version(t.d,t.id,t.v)}}(e));return"mark"in t&&!("limit"in this.options)?(this.index_request=!0,t=t.mark,n=function(t){return h.send("i:1:"+t+"::100"),h.irequest_time=h.now()},setTimeout((a=t,function(){return n(a)}),this.options.page_delay)):(this.index_request=!1,"current"in t?(this.data.last_cv=t.current,this._save_meta()):this.data.last_cv=0,0===i?this._index_loaded():void 0)},t.prototype.on_index_error=function(){return!1},t.prototype.load_versions=function(t,e){var i,n,s,r,o;if(!(t in this.data.store))return!1;for(o=[],n=s=i=Math.max(this.data.store[t].version-(e+1),1),r=this.data.store[t].version-1;i<=r?s<=r:r<=s;n=i<=r?++s:--s)o.push(this.send("e:"+t+"."+n));return o},t.prototype.get_version=function(t,e){return this.send("e:"+t+"."+e)},t.prototype.on_entity_version=function(t,e,i){var n,s,r;if(n=null!=t?this.jd.deepCopy(t):null,r=!1===this.initialized&&null!=this.cb_ni?this.cb_ni:this.cb_n,e in this.data.store&&"last"in this.data.store[e]&&this.jd.entries(this.data.store[e].last))return r(e,n=this.jd.deepCopy(this.data.store[e].last),null),this.notify_index[e]=!0,this._check_update(e);if(e in this.data.store&&i<this.data.store[e].version)return this.cb_nv(e,n,i);for(s in e in this.data.store||(this.data.store[e]={}),this.data.store[e].id=e,this.data.store[e].object=t,this.data.store[e].version=parseInt(i),r(e,n,i),this.notify_index[e]=!0,t=0,e=this.notify_index)o.call(e,s)&&!1===this.notify_index[s]&&t++;return 0===t&&!1===this.index_request?this._index_loaded():void 0},t.prototype._index_loaded=function(){return!1===this.initialized&&this.cb_r(),this.initialized=!0,this.retrieve_changes()},t.prototype._notify_client=function(t,e,i,n,s){var r,o,a,h,f;if(null!=this.cb_l)return r=this.cb_l(t),o=null,f=[],"array"===this.jd.typeOf(r)&&(a=r[2],h=r[1],r=r[0],o=this.s._captureCursor(a))&&(f[0]=o.startOffset,"endOffset"in o&&(f[1]=o.endOffset)),null!=r&&null!=i?(r=this.jd.object_diff(i,r),0===this.jd.entries(r)?e=i:n=this.jd.transform_object_diff(r,n,i),o?(e=this.jd.apply_object_diff_with_offsets(e,n,h,f),null!=a&&"value"in a&&(a.value=e[h]),o.startOffset=f[0],1<f.length&&(o.endOffset=f[1],o.startOffset>=o.endOffset&&(o.collapsed=!0)),this.s._restoreCursor(a,o)):e=this.jd.apply_object_diff(e,n),this.cb_n(t,e,s)):e?this.cb_n(t,e,s):this.cb_n(t,null,null);this.cb_n(t,e,s)},t.prototype._check_update=function(t){var e,i,n,s,r;if(!(t in this.data.store))return!1;if((i=this.data.store[t]).change){for(t=!1,n=0,s=(r=this.data.send_queue).length;n<s;n++)(e=r[n]).id===i.change.id&&e.ccid===i.change.ccid&&(t=!0);return!t&&(this._queue_change(i.change),!0)}return null==i.check&&("last"in i&&this.jd.equals(i.object,i.last)?(delete i.last,this._remove_entity(t),!1):(null!=(e=this._make_change(t))?(i.change=e,this._queue_change(e)):this._remove_entity(t),!0))},t.prototype.update=function(t,e){var i,n,s,r,o,a,h,f=this;if(1===arguments.length){if(null==this.cb_l)throw Error("missing 'local' callback");e=this.cb_l(t),"array"===this.jd.typeOf(e)&&(e=e[0])}if(null==t&&null==e)return!1;if(null!=t){if(0===t.length||-1!==t.indexOf("/"))return!1}else t=this.uuid();t in this.data.store||(this.data.store[t]={id:t,object:{},version:null,change:null,check:null}),(n=this.data.store[t]).last=this.jd.deepCopy(e),n.modified=this.s._time(),this._save_entity(t),s=0;for(r=(o=this.data.send_queue).length;s<r;s++)if(i=o[s],String(t)===i.id)return null;return null!=n.check&&clearTimeout(n.check),n.check=setTimeout((a=t,h=n,function(){return h.check=null,h.change=f._make_change(a),delete h.last,f._save_entity(a),f._queue_change(h.change)}),this.options.update_delay),t},t.prototype._make_change=function(t){var e,i;if(i=this.data.store[t],e={id:String(t),ccid:this.uuid()},this.initialized)if(null!=this.cb_l)t=this.cb_l(t),"array"===this.jd.typeOf(t)&&(t=t[0]);else{if(!("last"in i))return null;t=i.last}else{if(!("last"in i))return null;t=i.last}return null!=i.version&&(e.sv=i.version),null===t&&null!=i.version?e.o="-":null!=t&&null!=i.object?(e.o="M","sendfull"in i?(e.d=this.jd.deepCopy(t),delete i.sendfull):(e.v=this.jd.object_diff(i.object,t),0===this.jd.entries(e.v)&&(e=null))):e=null,e},t.prototype._queue_change=function(t){if(null!=t)return this.data.send_queue.push(t),this.send("c:"+JSON.stringify(t)),this._check_pending(),null!=this.data.send_queue_timer&&clearTimeout(this.data.send_queue_timer),this.data.send_queue_timer=setTimeout(this._send_changes,this._send_backoff)},t.prototype._send_changes=function(){var t,e,i,n;if(0!==this.data.send_queue.length){if(this.s.connected)for(e=0,i=(n=this.data.send_queue).length;e<i;e++)t=n[e],this.send("c:"+JSON.stringify(t));return this._send_backoff*=2,this._send_backoff>this._backoff_max&&(this._send_backoff=this._backoff_max),this.data.send_queue_timer=setTimeout(this._send_changes,this._send_backoff)}this.data.send_queue_timer=null},t.prototype.retrieve_changes=function(){this.send("cv:"+this.data.last_cv)},t.prototype.on_changes=function(t){var e,i,n,s,r,o,a,h,f,l,c,u,p,d=this;for(h=!(i=[]),this._send_backoff=this._backoff_min,f=0,c=t.length;f<c;f++){for(n=(e=t[f]).id,s=[],l=0,u=(p=this.data.send_queue).length;l<u;l++)a=p[l],e.clientid===this.clientid&&n===a.id&&(e.local=!0,s.push(a),i.push(n));for(a=0,l=s.length;a<l;a++)o=s[a],this.data.store[o.id].change=null,this._save_entity(o.id),this.data.send_queue=function(){var t,e,i,n;for(n=[],t=0,e=(i=this.data.send_queue).length;t<e;t++)(r=i[t])!==o&&n.push(r);return n}.call(this);if(0<s.length&&this._check_pending(),"error"in e)switch(e.error){case 412:-1<(n=i.indexOf(e.id))&&i.splice(n,1);break;case 409:break;case 405:e.id in this.data.store&&(this.data.store[e.id].version=null),h=!0;break;case 440:this.data.store[n].sendfull=!0;break;default:e.id in this.data.store&&(this.data.store[e.id].version=null),h=!0}else"-"===(s=e.o)?(delete this.data.store[n],this._remove_entity(n),"local"in e||this._notify_client(e.id,null,null,null,null)):"M"===s&&(s=this.data.store[n],"sv"in e&&null!=s&&null!=s.version&&s.version===e.sv||!("sv"in e)||1===e.ev?(null==s&&(this.data.store[n]={id:n,object:{},version:null,change:null,check:null},s=this.data.store[n]),n=this.jd.deepCopy(s.object),s.object=this.jd.apply_object_diff(s.object,e.v),s.version=e.ev,s=this.jd.deepCopy(s.object),"local"in e||this._notify_client(e.id,s,n,e.v,e.ev)):null!=s&&null!=s.version&&e.ev<=s.version||(null!=s&&(this.data.store[n].version=null),h=!0)),h||(this.data.last_cv=e.cv,this._save_meta())}if(h)setTimeout(function(){return d._refresh_store()});else for(t=function(t){return setTimeout(function(){return d._check_update(t)},d.options.update_delay)},h=0,f=i.length;h<f;h++)t(n=i[h])},t.prototype.pending=function(){var t,e,i,n,s;for(s=[],e=0,i=(n=this.data.send_queue).length;e<i;e++)t=n[e],s.push(t.id);for(s=[],e=0,i=(n=this.data.send_queue).length;e<i;e++)t=n[e],s.push(t.id);return s},t.prototype._check_pending=function(){var t,e,i,n,s,r;if(null!=this.cb_np){if(t=this.pending(),e=!0,this._last_pending)if(e=!1,this._last_pending.length===t.length)for(n=0,s=(r=this._last_pending).length;n<s;n++)i=r[n],-1===t.indexOf(i)&&(e=!0);else e=!0;if(e)return this._last_pending=t,this.cb_np(t)}},t}(),t=function(){function t(t,e){var i,n,s;if(this.app_id=t,this.options=e,this._restoreCursor=r(this._restoreCursor,this),this._captureCursor=r(this._captureCursor,this),this._sock_message=r(this._sock_message,this),this._sock_hb_check=r(this._sock_hb_check,this),this._sock_closed=r(this._sock_closed,this),this._sock_opened=r(this._sock_opened,this),this._sock_connect=r(this._sock_connect,this),this.synced=r(this.synced,this),this.send=r(this.send,this),this.stop=r(this.stop,this),this.start=r(this.start,this),this.on=r(this.on,this),this.bucket=r(this.bucket,this),this.bversion=2014030401,this.jd=new jsondiff,this.dmp=this.jd.dmp,this.auth_token=null,this.options=this.options||{},this.options.app_id=this.app_id,this.sock_opts={debug:!1},"sockjs"in this.options)for(i in s=this.options.sockjs)o.call(s,i)&&(n=s[i],this.sock_opts[i]=n);"host"in this.options||(this.options.host="api.simperium.com"),"port"in this.options||(this.options.port=80),"token"in this.options&&(this.auth_token=this.options.token),i=-1!==this.options.host.indexOf("simperium.com")?"https":"http",this.buckets={},this.channels=0,"update_delay"in this.options||(this.options.update_delay=0),"page_delay"in this.options||(this.options.page_delay=0),this.options.prefix="sock/1/"+this.app_id,this.options.port=parseInt(this.options.port),this.sock_url=80!==this.options.port&&443!==this.options.port?i+"://"+this.options.host+":"+this.options.port+"/"+this.options.prefix:i+"://"+this.options.host+"/"+this.options.prefix,this.stopped=!1,this._sock_backoff=3e3,this._sock_hb=1,this._sock_connect()}return t.prototype.lowerstrip=function(t){return t=t.toLowerCase(),null!=String.prototype.trim?t.trim():t.replace(/^\s+|\s+$/g,"")},t.prototype._time=function(){var t;return t=new Date,Date.UTC(t.getUTCFullYear(),t.getUTCMonth(),t.getUTCDate(),t.getUTCHours(),t.getUTCMinutes(),t.getUTCSeconds(),t.getUTCMilliseconds())/1e3},t.prototype.supports_html5_storage=function(){try{return"localStorage"in window&&null!==window.localStorage}catch(t){return!1}},t.prototype.bucket=function(t,e){var i;return t=this.lowerstrip(t),(e=e||{}).n=this.channels++,i=new n(this,t,e),this.buckets[e.n]=i},t.prototype.on=function(t,e,i){return this.buckets[t].on(e,i)},t.prototype.start=function(){var t,e,i;for(t in this.stopped=!1,i=[],e=this.buckets)o.call(e,t)&&(n=e[t],i.push(n.start()));return i},t.prototype.stop=function(){if(this.stopped=!0,null!=this.sock)return this.sock.close()},t.prototype.send=function(t){return this.sock.send(t)},t.prototype.synced=function(){var t,e;for(t in e=this.buckets)if(o.call(e,t)&&0<(n=e[t]).pending().length)return!1;return!0},t.prototype._sock_connect=function(){return this.authorized=this.connected=!1,this.sock=new SockJS(this.sock_url,void 0,this.sock_opts),this.sock.onopen=this._sock_opened,this.sock.onmessage=this._sock_message,this.sock.onclose=this._sock_closed},t.prototype._sock_opened=function(){var t,e,i;for(t in this._sock_backoff=3e3,this.connected=!0,this._sock_hb_timer=setTimeout(this._sock_hb_check,2e4),i=[],e=this.buckets)o.call(e,t)&&((n=e[t]).started?i.push(n.start()):i.push(void 0));return i},t.prototype._sock_closed=function(){var t,e;for(t in this.connected=!1,e=this.buckets)o.call(e,t)&&((n=e[t]).authorized=!1);if(this._sock_backoff=this._sock_backoff<4e3?this._sock_backoff+1:15e3,this._sock_hb_timer&&(clearTimeout(this._sock_hb_timer),this._sock_hb_timer=null),!this.stopped)return setTimeout(this._sock_connect,this._sock_backoff)},t.prototype._sock_hb_check=function(){var t;if(t=(new Date).getTime()-this._sock_msg_time,!1!==this.connected)return 4e4<t?this.sock.close():15e3<t&&this.sock.send("h:"+this._sock_hb),this._sock_hb_timer=setTimeout(this._sock_hb_check,2e4)},t.prototype._sock_message=function(e){var t,i;if(this._sock_msg_time=(new Date).getTime(),t=e.data,e=null,1===(i=t.indexOf(":"))&&"h"===t.charAt(0))this._sock_hb=t.substr(2);else{try{e=parseInt(t.substr(0,i)),t=t.substr(i+1)}catch(t){e=null}if(null!==e&&e in this.buckets)return this.buckets[e].on_data(t)}},t.prototype._captureCursor=function(t){},t.prototype._captureCursor=function(t){if("activeElement"in t&&!t.activeElement)return null;var e=this.dmp.Match_MaxBits/2,i=t.value,n={};if("selectionStart"in t){try{var s=t.selectionStart,r=t.selectionEnd}catch(t){return null}n.startPrefix=i.substring(s-e,s),n.startSuffix=i.substring(s,s+e),n.startOffset=s,n.collapsed=s==r,n.collapsed||(n.endPrefix=i.substring(r-e,r),n.endSuffix=i.substring(r,r+e),n.endOffset=r)}else{for(s=t;s.parentNode;)s=s.parentNode;if(!s.selection||!s.selection.createRange)return null;if((i=s.selection.createRange()).parentElement()!=t)return null;s=s.body.createTextRange(),n.collapsed=""==i.text,s.moveToElementText(t),n.collapsed||(s.setEndPoint("EndToEnd",i),n.endPrefix=s.text,n.endOffset=n.endPrefix.length,n.endPrefix=n.endPrefix.substring(n.endPrefix.length-e)),s.setEndPoint("EndToStart",i),n.startPrefix=s.text,n.startOffset=n.startPrefix.length,n.startPrefix=n.startPrefix.substring(n.startPrefix.length-e),s.moveToElementText(t),s.setEndPoint("StartToStart",i),n.startSuffix=s.text.substring(0,e),n.collapsed||(s.setEndPoint("StartToEnd",i),n.endSuffix=s.text.substring(0,e))}return"scrollTop"in t&&(n.scrollTop=t.scrollTop/t.scrollHeight,n.scrollLeft=t.scrollLeft/t.scrollWidth),n},t.prototype._restoreCursor=function(t,e){},t.prototype._restoreCursor=function(t,e){this.dmp.Match_Distance=1e3,this.dmp.Match_Threshold=.9;var i,n=this.dmp.Match_MaxBits/2,s=t.value,r=e.startPrefix+e.startSuffix,o=this.dmp.match_main(s,r,e.startOffset-n);null!==o&&(i=s.substring(o,o+r.length),r=this.dmp.diff_main(r,i,!1),o+=this.dmp.diff_xIndex(r,e.startPrefix.length));var a=null;if(e.collapsed||(r=e.endPrefix+e.endSuffix,null!==(a=this.dmp.match_main(s,r,e.endOffset-n))&&(i=s.substring(a,a+r.length),r=this.dmp.diff_main(r,i,!1),a+=this.dmp.diff_xIndex(r,e.endPrefix.length))),null===o&&null!==a?o=a:null===o&&null===a&&(o=e.startOffset),null===a&&(a=o),"selectionStart"in t)t.selectionStart=o,t.selectionEnd=a;else{for(n=t;n.parentNode;)n=n.parentNode;if(!n.selection||!n.selection.createRange)return;s=(s=t.value.substring(0,o)).replace(/\r\n/g,"\n").length,(n=n.body.createTextRange()).moveToElementText(t),n.collapse(!0),n.moveStart("character",s),e.collapsed||(o=(s=t.value.substring(o,a)).replace(/\r\n/g,"\n").length,n.moveEnd("character",o)),n.select()}"scrollTop"in e&&(t.scrollTop=e.scrollTop*t.scrollHeight,t.scrollLeft=e.scrollLeft*t.scrollWidth)},t}(),window.Simperium=t,n.prototype.on=n.prototype.on,n.prototype.start=n.prototype.start,n.prototype.load_versions=n.prototype.load_versions,n.prototype.pending=n.prototype.pending,t.prototype.on=t.prototype.on,t.prototype.start=t.prototype.start,t.prototype.bucket=t.prototype.bucket,t.prototype.synced=t.prototype.synced}.call(this);