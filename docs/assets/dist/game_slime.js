!function(e){var t={};function s(i){if(t[i])return t[i].exports;var n=t[i]={i:i,l:!1,exports:{}};return e[i].call(n.exports,n,n.exports,s),n.l=!0,n.exports}s.m=e,s.c=t,s.d=function(e,t,i){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},s.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(s.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)s.d(i,n,function(t){return e[t]}.bind(null,n));return i},s.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="",s(s.s=18)}([function(e,t,s){"use strict";function i(e){return document.getElementById(e)}Object.defineProperty(t,"__esModule",{value:!0}),t.$id=i,t.$idA=function(e){return i(e)},t.$ready=function(e){document.addEventListener("DOMContentLoaded",e)},t.removeAllChildNodes=function(e){for(;e.firstChild;)e.removeChild(e.firstChild)},t.randomArrayItem=function(e){return e[Math.floor(Math.random()*e.length)]},t.shuffle=function(e){for(let t=e.length-1;t;--t){const s=Math.floor(Math.random()*(t+1)),i=e[t];e[t]=e[s],e[s]=i}},t.sum=function(e){return e.reduce((e,t)=>e+t,0)},t.formatHexColor=function(e){return"#"+("00000"+e.toString(16)).slice(-6)},t.clamp=function(e,t,s){return Math.max(t,Math.min(e,s))}},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=s(19),n=s(20);t.SLIME_SIZE=.1,t.BALL_RADIUS=.03,t.FLOOR_SIZE=.2,t.SPAWN_P1_X=.45,t.SPAWN_P2_X=2-t.SPAWN_P1_X,t.SPAWN_BALL_Y=.5;t.Game=class{constructor(){this.status=0,this.p1=new n.Player,this.p2=new n.Player,this.ball=new i.Ball,this.smoothDelay=1e3,this.hasServerOpponent=!1,this.p1.respawn(!0),this.p2.respawn(!1),this.ball.respawn(!0)}update(e){this.smoothDelay=(4*this.smoothDelay+e)/5,e&&(this.ball.move(e),this.p1.move(e),this.p2.move(e))}getP1(){return this.p1}getP2(){return this.p2}getBall(){return this.ball}getStatus(){return this.status}getSmoothDelay(){return this.smoothDelay}getFPS(){return 1e3/Math.max(this.smoothDelay,.5)}hasOpponent(){return this.hasServerOpponent}setName(e){this.p1.name=e}setColor(e){this.p1.color=e}processServerDisconnect(){this.p1.ping=this.p2.ping=-1}processServerWelcome(e,t){this.p1.color=e,this.p1.name=t}processServerState(e,t,s,i,n,a){this.p1.setServerLocation(e,t),this.p2.setServerLocation(s,i),this.ball.setServerLocation(n,a)}processServerEnter(e,t){this.hasServerOpponent=!0,this.p1.score=this.p2.score=0,this.p2.color=e,this.p2.name=t}processServerLeave(){this.hasServerOpponent=!1}processServerWin(){this.p1.score++,this.status=1}processServerLose(){this.p2.score++,this.status=2}processServerRoundStart(e){this.p1.respawn(!0),this.p2.respawn(!1),this.ball.respawn(e),this.status=0}processServerPingTimes(e,t){this.p1.ping=e,this.p2.ping=t}}},,,function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.PhysicalEntity=class{constructor(){this.x=0,this.y=0,this.xe=0,this.ye=0,this.reset()}reset(){this.x=0,this.y=0,this.xe=0,this.ye=0}move(e){const t=Math.pow(.001,e/1e3);this.xe*=t,this.ye*=t}setServerLocation(e,t){this.xe+=this.x-e,this.ye+=this.y-t,this.x=e,this.y=t}}},,,,,,,,,,,,,,function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=s(1),n=s(21),a=s(22),r=s(24);class o{constructor(){this.game=new i.Game,this.ui=new r.SlimeUI(this),this.net=new n.PlayerIOConnector(this),this.gameDrawer=new a.GameDrawer(this.game,()=>this.net.readyState()),this.ui.restoreSettings()}processUIupdate(e){this.game.update(e),this.net.update(),this.gameDrawer.fancy.update(e),this.gameDrawer.draw(this.ui.getContext())}processUIconnect(){this.net.isConnected()?this.net.disconnect():this.net.connect()}processUIchangeName(e){this.net.isConnected()||this.game.setName(e)}processUIchangeColor(e){this.net.isConnected()||this.game.setColor(e)}processUIchangeFlipP1(e){this.gameDrawer.flipP1=e}processUIchangeFancyBackground(e){this.gameDrawer.drawFancyBackground=e}processUIchangeDrawDev(e){this.gameDrawer.drawDev=e}getUserName(){return this.ui.getUserName()}getUserColor(){return this.ui.getUserColor()}getKeyFlags(){const e=this.gameDrawer.flipP1;let t=this.ui.getInputManager().getKeyFlags(e);const s=this.ui.getInputManager().getMouse();if(s.isValid()){let i=s.getX();e&&(i=1-i);const n=Math.min(Math.max(2*i,0),1),a=s.getY()<.45,r=this.game.getP1().x;!(3&t)&&Math.abs(r-n)>.05&&(t|=r<n?2:1),a&&(t|=4)}return t}shouldSendNetworkUpdate(){return this.game.hasOpponent()}processServerConnect(){this.ui.processServerConnect()}processServerDisconnect(){this.game.processServerDisconnect(),this.ui.processServerDisconnect()}processServerWelcome(e,t){this.game.processServerWelcome(e,t)}processServerState(e,t,s,i,n,a){this.game.processServerState(e,t,s,i,n,a)}processServerEnter(e,t){this.game.processServerEnter(e,t)}processServerLeave(){this.game.processServerLeave()}processServerWin(){this.game.processServerWin()}processServerLose(){this.game.processServerLose()}processServerRoundStart(e){this.game.processServerRoundStart(e)}processServerPingTimes(e,t){this.game.processServerPingTimes(e,t)}}s(0).$ready(()=>{new o})},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=s(1),n=s(4);t.Ball=class extends n.PhysicalEntity{respawn(e){this.x=e?i.SPAWN_P1_X:i.SPAWN_P2_X,this.y=i.SPAWN_BALL_Y,this.xe=0,this.ye=0}}},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=s(1),n=s(4);t.Player=class extends n.PhysicalEntity{constructor(){super(...arguments),this.name="",this.color="#7f0",this.score=0,this.ping=-1}respawn(e){this.reset(),this.x=e?i.SPAWN_P1_X:i.SPAWN_P2_X}}},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=s(0),n="slime-fd3iliszksmlav83stww",a="public",r="localhost:8184";t.PlayerIOConnector=class{constructor(e){this.game=e,this.state=3,this.lastKeySent=-1}isConnected(){return 3!==this.readyState()}readyState(){return this.state}connect(){this.disconnect(),this.state=0;const e=e=>{console.log(e),this.disconnected()};PlayerIO.authenticate(n,a,{userId:"guest"},{},t=>{this.state=1,t.multiplayer.developmentServer=r;const s=()=>{t.multiplayer.createJoinRoom("$service-room$","match",!1,null,null,e=>{this.connection=e,e.addMessageCallback("m",t=>{n(t.getString(0)),e.disconnect()})},e)},n=n=>{t.multiplayer.createJoinRoom(n,"slime",!0,null,null,e=>{this.connection=e,e.addDisconnectCallback(()=>{this.game.processServerLeave(),s()}),e.addMessageCallback("welcome",e=>{const t=i.formatHexColor(16777215&e.getUInt(0)),s=e.getString(1);this.game.processServerWelcome(t,s)}),e.addMessageCallback("s",e=>{const t=65535,s=e.getByteArray(0),i=(s[1]<<8|s[2])/t,n=(s[3]<<8|s[4])/t,a=2-(s[7]<<8|s[8])/t,r=(s[9]<<8|s[10])/t,o=(s[13]<<8|s[14])/t*2,c=(s[15]<<8|s[16])/t;this.game.processServerState(i,n,a,r,o,c)}),e.addMessageCallback("enter",e=>{const t=i.formatHexColor(16777215&e.getUInt(0)),s=e.getString(1);this.game.processServerEnter(t,s),this.lastKeySent=-1}),e.addMessageCallback("win",()=>this.game.processServerWin()),e.addMessageCallback("lose",()=>this.game.processServerLose()),e.addMessageCallback("nextRound",e=>this.game.processServerRoundStart(e.getBoolean(0))),e.addMessageCallback("t",e=>{this.game.processServerPingTimes(e.getUInt(0),e.getUInt(1))}),e.addMessageCallback("p",t=>e.sendMessage(t));let t=this.game.getUserName(),n=this.game.getUserColor();e.send("init",n,t)},e)};s()},e),this.game.processServerConnect()}disconnect(){this.connection&&(this.state=2,this.connection.addDisconnectCallback(()=>this.disconnected()),this.connection.disconnect())}disconnected(){this.state=3,this.connection=void 0,this.game.processServerDisconnect()}update(){if(!this.connection)return;if(!this.game.shouldSendNetworkUpdate())return;const e=this.game.getKeyFlags();this.lastKeySent!==e&&this.connection.send("k",e)}}},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=s(1),n=s(23);t.GameDrawer=class{constructor(e,t){this.game=e,this.getNetStatus=t,this.drawFancyBackground=!1,this.drawDev=!1,this.flipP1=!1,this.fancy=new n.FancyDrawer}draw(e){let t=e.canvas.height,s=2*t;if(this.drawClear(e,s,t),this.drawFancyBackground&&this.fancy.draw(e,s,t),!this.game)return;this.drawFloor(e,s,t),this.drawNet(e,s,t),this.drawBall(e,s,t);const i=this.game.getP1(),n=this.game.getP2();let a;switch(this.drawSlimer(e,s,t,i.x+i.xe,i.y+i.ye,i.color,i.name,!1),this.game.hasOpponent()&&(this.drawSlimer(e,s,t,n.x+n.xe,n.y+n.ye,n.color,n.name,!0),this.drawPing(e,s,t,i.ping,!this.flipP1),this.drawPing(e,s,t,n.ping,this.flipP1)),this.drawDev&&(this.drawBall(e,s,t,!0),this.drawSlimer(e,s,t,i.x,i.y,i.color,i.name,!1,!0),this.drawSlimer(e,s,t,n.x,n.y,n.color,n.name,!0,!0)),this.drawScore(e,s,t,i.score,n.score),this.getNetStatus()){case 0:a="Connecting";break;case 1:this.game.hasOpponent()?1===this.game.getStatus()?a="You won the round!":2===this.game.getStatus()&&(a="You lost the round!"):a="Waiting for opponent";break;case 2:a="Disconnecting";break;case 3:a="Disconnected"}a&&this.drawStatus(e,s,t,a),this.drawFPS(e,s,t)}drawClear(e,t,s){const i=e.createRadialGradient(t/2,s/2,0,t/2,s/2,s);i.addColorStop(0,"#0df"),i.addColorStop(1,"#26b"),e.fillStyle=i,e.fillRect(0,0,t,s)}drawFloor(e,t,s){e.fillStyle="#999",e.fillRect(0,s*(1-i.FLOOR_SIZE),t,s)}drawNet(e,t,s){e.fillStyle="#fff",e.fillRect(.495*t,.625*s,.01*t,.2*s)}drawBall(e,t,s,n){const a=this.game.getBall();let r=a.x,o=a.y;if(n||(r+=a.xe,o+=a.ye),this.flipP1&&(r=2-r),o=1-o-i.FLOOR_SIZE,e.beginPath(),e.arc(r*s,o*s,i.BALL_RADIUS*s,0,2*Math.PI),e.closePath(),n)return e.lineWidth=2,e.strokeStyle="red",void e.stroke();e.fillStyle=1===this.game.getStatus()?"#0f0":2===this.game.getStatus()?"red":"#ff0",e.fill()}drawSlimer(e,t,s,n,a,r,o,c,h){const l=this.game.getBall();if(this.flipP1&&(n=2-n),a=1-a-i.FLOOR_SIZE,e.beginPath(),e.arc(n*s,a*s,i.SLIME_SIZE*s,0,Math.PI,!0),e.closePath(),h)return e.lineWidth=2,e.strokeStyle="red",void e.stroke();e.fillStyle=r,e.fill();let d=n+(this.flipP1!==c?-.0535:.0535),g=a-.0525;e.beginPath(),e.arc(d*s,g*s,.0175*s,0,2*Math.PI,!0),e.closePath(),e.fillStyle="#fff",e.fill();let u=(this.flipP1?2-(l.x+l.xe):l.x+l.xe)-d,p=1-(l.y+l.ye)-i.FLOOR_SIZE-g,m=u*u+p*p;if(m>25e-6){let e=.005/Math.sqrt(m);d+=u*e,g+=p*e}else d=l.x+l.xe,g=l.y+l.ye;e.beginPath(),e.arc(d*s,g*s,.01*s,0,2*Math.PI,!0),e.closePath(),e.fillStyle="#000",e.fill(),o&&(e.font=.0225*t+"px Verdana, sans-serif",e.textAlign="center",e.fillStyle="#ccc",e.fillText(o,n*s,(a-.05-i.SLIME_SIZE)*s))}drawScore(e,t,s,i,n){e.font=.05*t+"px sans-serif",e.textAlign="center",e.fillStyle="#fd0",e.fillText(i+"",(this.flipP1?.92:.08)*t,.15*s),e.fillText(n+"",(this.flipP1?.08:.92)*t,.15*s)}drawStatus(e,t,s,i){e.font=.04*t+"px sans-serif",e.textAlign="center",e.fillStyle="#ddd",e.fillText(i,.5*t,.15*s)}drawFPS(e,t,s){if(!this.game)return;const i=this.game.getFPS();e.font=.02*t+"px monospace",e.textAlign="left",e.fillStyle="#fa0",e.fillText(Math.round(i)+" fps",.01*t,.97*s)}drawPing(e,t,s,i,n){i<0||(e.font=.02*t+"px monospace",e.textAlign=n?"left":"right",e.fillStyle="#fa0",e.fillText(i+" ms",(n?.01:.99)*t,.85*s))}}},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=s(1),n=40,a=.0375;class r{constructor(){this.x=Math.random(),this.y=Math.random(),this.vx=Math.floor(7*Math.random()-3)/800*.06,this.vy=Math.floor(3*Math.random()+1)/400*.06,this.rgb=16777215*Math.random()|0,this.a=.6*Math.random()+.1,this.blurSize=(Math.floor(10*Math.random())+5)/2/800,this.scale=.7*Math.random()+.3}}t.FancyDrawer=class{constructor(e=n){this.fancy=new Array(e).fill(void 0).map(e=>new r)}update(e){if(e)for(let t=0;t<this.fancy.length;++t)this.fancy[t].x+=this.fancy[t].vx*e,this.fancy[t].y+=this.fancy[t].vy*e,(this.fancy[t].x<-a||this.fancy[t].x>1+a)&&(this.fancy[t].x%=1+2*a),this.fancy[t].x<-a&&(this.fancy[t].x+=1+2*a),this.fancy[t].y>1+2*a-i.FLOOR_SIZE&&(this.fancy[t].y-=1+4*a-i.FLOOR_SIZE)}draw(e,t,s){e.save(),e.globalCompositeOperation="screen";for(let i=0;i<this.fancy.length;++i){let{x:n,y:r,a:o,blurSize:c,scale:h}=this.fancy[i],l=this.fancy[i].rgb>>16,d=this.fancy[i].rgb>>8&255,g=255&this.fancy[i].rgb;e.beginPath(),e.arc(n*t,r*s,a*h*t,0,2*Math.PI),e.closePath(),e.filter="blur("+c*h*t+"px)",e.fillStyle="rgba("+l+","+d+","+g+","+o+")",e.fill()}e.restore()}}},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=s(0),n=s(25),a=s(26);t.SlimeUI=class{constructor(e){this.game=e,this.$canvas=i.$idA("gameCanvas"),this.$pName=i.$idA("pName"),this.$pColor=i.$idA("pColor"),this.$connect=i.$idA("connect"),this.$flipP1=i.$idA("flipP1"),this.$notFlipP1=i.$idA("notFlipP1"),this.$background=i.$idA("background"),this.$devMode=i.$idA("devMode"),this.$fullscreen=i.$idA("fullscreen"),this.canvasGame=new n.CanvasGame(this.$canvas,e=>this.game.processUIupdate(e)),this.input=new a.SlimeInput,this.input.attachListeners(window),i.$idA("connect").addEventListener("click",()=>this.game.processUIconnect()),i.$idA("fullscreen").addEventListener("click",()=>{this.$fullscreen.checked=!1,this.canvasGame.getCanvas().requestFullscreen().then().catch()}),this.$pName.addEventListener("change",()=>{const e=this.$pName.value;this.game.processUIchangeName(e),window.localStorage.n=e}),this.$pColor.addEventListener("change",()=>{const e=this.$pColor.value;this.game.processUIchangeColor(i.formatHexColor(parseInt(e,16))),window.localStorage.c=e}),this.$flipP1.addEventListener("change",()=>{const e=this.$flipP1.checked;this.game.processUIchangeFlipP1(e),window.localStorage.f=e?"1":"0"}),this.$notFlipP1.addEventListener("change",()=>{const e=!this.$notFlipP1.checked;this.game.processUIchangeFlipP1(e),window.localStorage.f=e?"1":"0"}),this.$background.addEventListener("change",()=>{const e=this.$background.checked;this.game.processUIchangeFancyBackground(e),window.localStorage.b=e?"1":"0"}),this.$devMode.addEventListener("change",()=>{const e=this.$devMode.checked;this.game.processUIchangeDrawDev(e),window.localStorage.d=e?"1":"0"})}getContext(){return this.canvasGame.getContext()}getUserName(){return this.$pName.value}getUserColor(){let e=parseInt(this.$pColor.value,16);return Number.isNaN(e)?7864064:16777215&e}setUserName(e){this.$pName.value=e}setUserColor(e){this.$pColor.value=e}getInputManager(){return this.input}restoreSettings(){window.localStorage.n&&this.game.processUIchangeName(this.$pName.value=window.localStorage.n),window.localStorage.c&&this.game.processUIchangeColor(i.formatHexColor(this.$pColor.value=window.localStorage.c)),"1"===window.localStorage.f&&this.game.processUIchangeFlipP1(this.$flipP1.checked=!0),"1"===window.localStorage.b&&this.game.processUIchangeFancyBackground(this.$background.checked=!0),"1"===window.localStorage.d&&this.game.processUIchangeDrawDev(this.$devMode.checked=!0)}processServerConnect(){this.$pName.disabled=!0,this.$pColor.disabled=!0,this.$connect.innerHTML="Disconnect",this.$connect.className="btn btn-danger"}processServerDisconnect(){this.$pName.disabled=!1,this.$pColor.disabled=!1,this.$connect.innerHTML="Connect",this.$connect.className="btn btn-primary"}}},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.CanvasGame=class{constructor(e,t){this.canvas=e,this.animationCallback=t,this.lastGameTime=Date.now(),this.context=e.getContext("2d"),window.requestAnimationFrame(()=>this.drawFrame()),document.addEventListener("fullscreenchange",()=>this.resize()),window.addEventListener("resize",()=>this.resize()),this.resize()}drawFrame(){window.requestAnimationFrame(()=>this.drawFrame());const e=Date.now(),t=e-this.lastGameTime;this.lastGameTime=e,this.animationCallback(t)}getCanvas(){return this.canvas}getContext(){return this.context}resize(){if(window.innerWidth===window.screen.width&&window.innerHeight===window.screen.height)this.canvas.width=Math.min(window.innerWidth,2*window.innerHeight),this.canvas.height=Math.min(window.innerHeight,window.innerWidth/2);else{const e=this.canvas.parentNode;this.canvas.width=Math.min(e.clientWidth,2*e.clientHeight),this.canvas.height=Math.min(e.clientHeight,e.clientWidth/2)}}}},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=s(27),n=s(28);t.SlimeInput=class{constructor(){this.keyManager=new i.KeyInputManager,this.keyFlags=0,this.keyFlagsFlip=0,this.mouseManager=new n.MouseInputManager}getKeyFlags(e){return e?this.keyFlagsFlip:this.keyFlags}getMouse(){return this.mouseManager}KeyL(){return this.keyManager.isOn(37)||this.keyManager.isOn(65)}KeyU(){return this.keyManager.isOn(38)||this.keyManager.isOn(87)}KeyR(){return this.keyManager.isOn(39)||this.keyManager.isOn(68)}updateKeyFlags(){const e=this.KeyL()?1:0,t=this.KeyR()?1:0,s=this.KeyU()?1:0;this.keyFlags=0|e|t<<1|s<<2,this.keyFlagsFlip=0|t|e<<1|s<<2}attachListeners(e){this.keyManager.attachListeners(e,()=>this.updateKeyFlags())}}},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.KeyInputManager=class{constructor(){this.keys={}}on(e){this.keys[e]=!0}off(e){delete this.keys[e]}isOn(e){return e in this.keys}attachListeners(e,t){e.addEventListener("keydown",e=>{this.on(e.keyCode),t()}),e.addEventListener("keyup",e=>{this.off(e.keyCode),t()})}}},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=s(0);t.MouseInputManager=class{constructor(){this.x=0,this.y=0,this.valid=!1}isValid(){return this.valid}getX(){return this.x}getY(){return this.y}attachListeners(e){e.addEventListener("mousemove",t=>this.movestart(t.clientX,t.clientY,e)),e.addEventListener("touchmove",t=>this.touchmove(t,e)),e.addEventListener("mouseleave",()=>this.movestop()),e.addEventListener("touchend",()=>this.movestop()),e.addEventListener("touchcancel",()=>this.movestop())}movestart(e,t,s){this.x=i.clamp((e-s.getBoundingClientRect().left)/s.width,0,1),this.y=i.clamp((t-s.getBoundingClientRect().top)/s.height,0,1),this.valid=!0}movestop(){this.valid=!1}touchmove(e,t){if(e.targetTouches.length<1)return;e.preventDefault();let s=e.targetTouches.item(0);s&&this.movestart(s.clientX,s.clientY,t)}}}]);