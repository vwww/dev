<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
   "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
	<head>
		<title>Ping Test</title>
		<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
		<script type="text/javascript" src="http://p.cdn.victorz.ca/js/jquery-latest.js"></script>
		<script type="text/javascript">
		<!--
			pingThread = pingDelayVal = pingCur = pingRec = 0;
			pingData = [];
		-->
		</script>
	</head>
	<body>
		<h1>Ping Test</h1>
		<label>Entries to track:
			<select id="pingTrack" class="disableSelects">
				<option>1</option>
				<option>2</option>
				<option selected="selected">100</option>
				<option>200</option>
				<option>1000</option>
			</select>
		</label>
		<label>Seconds/ping
			<select id="pingDelay" class="disableSelects">
				<option value="0.25" selected="selected">1/4</option>
				<option value="0.5">1/2</option>
				<option>1</option>
				<option value="1.5">1 1/2</option>
				<option>2</option>
				<option>3</option>
				<option>5</option>
			</select>
		</label>
		<label>Number of pings
			<select id="pingMax" class="disableSelects">
				<option value="0">Unlimited</option>
				<option>10</option>
				<option>20</option>
				<option>35</option>
				<option>50</option>
				<option>100</option>
				<option selected="selected">200</option>
			</select>
		</label>
		<h2>Ping: <a id="pingResult">Unknown</a></h2>
		<h3>Samples: AVERAGE + MAX - MIN = CURRENT</h3>
		<input type="button" value="Start Pinging" id="pingControl" onclick="pingControlClicked()" />
		<h5>This uses AJAX to test the latency. <a id="noscriptMsg" style="color: red">You don't have javascript working!</a></h5>
		<h6><a href="http://validator.w3.org/check?uri=referer">W3C XHTML Transitional Valid</a></h6>
		<script type="text/javascript">
		<!--
			$("#noscriptMsg").css("color", "green").html("JavaScript works");
			function pingCallback(){
				if(++pingCur > parseInt($("#pingMax").val()) && parseInt($("#pingMax").val()) > 0) clearInterval(pingThread);
				else{
					var url = "?q=" + (new Date()).getTime();
					$.ajax({
						url: url,
						method: 'HEAD',
						context: new Date(),
						complete: function(){
							var delay = new Date() - this;
							if(pingData.length > parseInt($("#pingTrack").val())) pingData.shift();
							pingData.push(delay);
							pingM = pingL = pingA = 0;
							for(i in pingData){
								if(pingData[i] < pingL || pingL < 1) pingL = pingData[i];
								if(pingData[i] > pingM) pingM = pingData[i];
								pingA += pingData[i];
							}
							pingA = parseInt(pingA / pingData.length);
							if(++pingRec >= parseInt($("#pingMax").val()) && parseInt($("#pingMax").val()) > 0) stopPing();
							$("#pingResult").html(pingRec + ": " + pingA + "+" + pingM + "-" + pingL + "=" + delay);
						}
						});
				}
			}
			function stopPing(){
				clearInterval(pingThread);
				$("#pingControl").attr("value", "Start Pinging");
				$('.disableSelects').attr("disabled", false);
				pingData = [];
			}
			function pingControlClicked(){
				if($("#pingControl").attr("value") == "Start Pinging"){
					pingCur = pingRec = 0;
					pingData = [];
					$('.disableSelects').attr("disabled", true);
					pingThread = setInterval(pingCallback, parseFloat($("#pingDelay").val()) * 1000);
					$("#pingControl").attr("value", "Stop Pinging");
				}
				else stopPing();
			}
		-->
		</script>
	</body>
</html>