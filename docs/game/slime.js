(function(){function r(a){return"#"+("00000"+a.toString(16)).slice(-6)}function O(a,b,c,f,d,e,h,g){k&&(f=2-f);d=1-d-.2;a.beginPath();a.arc(f*c,d*c,.1*c,0,Math.PI,!0);a.closePath();a.fillStyle=e;a.fill();e=f+(k^g?-.0535:.0535);g=d-.0525;a.beginPath();a.arc(e*c,g*c,.0175*c,0,2*Math.PI,!0);a.closePath();a.fillStyle="#fff";a.fill();var E=(k?2-p:p)-e,l=1-w-.2-g,m=E*E+l*l;2.5E-5<m?(m=.005/Math.sqrt(m),e+=E*m,g+=l*m):(e=p,g=w);a.beginPath();a.arc(e*c,g*c,.01*c,0,2*Math.PI,!0);a.closePath();a.fillStyle="#000";a.fill();h&&(a.font=.0225*b+"px Verdana, sans-serif",a.textAlign="center",a.fillStyle="#ccc",a.fillText(h,f*c,(d-.05-.1)*c))}function P(a,b,c,f,d){0>f||(a.font=.02*b+"px monospace",a.textAlign=d?"left":"right",a.fillStyle="#fa0",a.fillText(f+" ms",(d?.01:.99)*b,.85*c))}function Q(){window.requestAnimationFrame(Q);var a=Date.now(),b=a-R;F=(4*F+b)/5;if(b&&(R=a,z))for(a=0;a<d.length;++a){d[a][0]+=d[a][2]*b;d[a][1]+=d[a][3]*b;if(-.0375>d[a][0]||1.0375<d[a][0])d[a][0]%=1.075;-.0375>d[a][0]&&(d[a][0]+=1.075);.875<d[a][1]&&(d[a][1]-=.95)}g&&t&&(b=S,G&&(!(b&3)&&.05<Math.abs(u-m)&&(b|=u<m?2:1),T&&(b|=4)),H!==b&&(a=new Uint8Array(1),a[0]=H=b,g.send(a.buffer)));var b=X,a=b.canvas.height,c=2*a,f=b.createRadialGradient(c/2,a/2,0,c/2,a/2,a);f.addColorStop(0,"#0df");f.addColorStop(1,"#26b");b.fillStyle=f;b.fillRect(0,0,c,a);if(z){b.save();b.globalCompositeOperation="screen";for(f=0;f<d.length;++f){var e=d[f][0],h=d[f][1],l=d[f][4]>>16,r=d[f][4]>>8&255,v=d[f][4]&255,x=d[f][5],D=d[f][6],y=d[f][7];b.beginPath();b.arc(e*c,h*a,.0375*y*c,0,2*Math.PI);b.closePath();b.filter="blur("+D*y*c+"px)";b.fillStyle="rgba("+l+","+r+","+v+","+x+")";b.fill()}b.restore()}b.fillStyle="#999";b.fillRect(0,.8*a,c,a);b.fillStyle="#fff";b.fillRect(.495*c,.625*a,.01*c,.2*a);f=k?2-p:p;e=1-w-.2;b.beginPath();b.arc(f*a,e*a,.03*a,0,2*Math.PI);b.closePath();b.fillStyle=1===q?"#0f0":2===q?"red":"#ff0";b.fill();O(b,c,a,u,I,A,B,!1);g&&t&&(O(b,c,a,C,J,U,V,!0),P(b,c,a,K,!k),P(b,c,a,L,k));b.font=.05*c+"px sans-serif";b.textAlign="center";b.fillStyle="#fd0";b.fillText(M,(k?.92:.08)*c,.15*a);b.fillText(N,(k?.08:.92)*c,.15*a);var n;g?0===g.readyState?n="Connecting":2===g.readyState?n="Disconnecting":t?1===q?n="You won the round!":2===q&&(n="You lost the round!"):n="Waiting for opponent":n="Disconnected";n&&(b.font=.04*c+"px sans-serif",b.textAlign="center",b.fillStyle="#ddd",b.fillText(n,.5*c,.15*a));n=1E3/Math.max(F,.5);b.font=.02*c+"px monospace";b.textAlign="left";b.fillStyle="#fa0";b.fillText(Math.round(n)+" fps",.01*c,.97*a)}function x(){window.innerWidth===window.screen.width&&window.innerHeight===window.screen.height?(h.width=Math.min(window.innerWidth,2*window.innerHeight),h.height=Math.min(window.innerHeight,window.innerWidth/2)):(h.width=Math.min(h.parentNode.clientWidth,2*h.parentNode.clientHeight),h.height=Math.min(h.parentNode.clientHeight,h.parentNode.clientWidth/2))}function Y(){g=new WebSocket("wss://s-acrf.rhcloud.com:8443/s");g.binaryType="arraybuffer";g.onopen=Z;g.onmessage=aa;g.onclose=D;g.onerror=D;t=!1;e("pName").disabled=!0;e("pColor").disabled=!0;e("connect").innerHTML="Disconnect";e("connect").className="btn btn-danger"}function ba(){g.close()}function D(){g=void 0;L=K=-1;e("pName").disabled=!1;e("pColor").disabled=!1;e("connect").innerHTML="Connect";e("connect").className="btn btn-primary"}function Z(){var a=e("pName").value,b=parseInt(e("pColor").value,16);var c=Number.isNaN(b)?7864064:b&16777215;var b=new ArrayBuffer(a.length+3),f=new DataView(b);f.setUint16(0,c>>8);f.setUint8(2,c&255);c=new Uint8Array(b,3);for(var f=0,d=a.length;f<d;++f)c[f]=a.charCodeAt(f);g.send(b)}function aa(a){a=a.data;var b=new DataView(a),c=b.getUint8(0);c?1===c?(u=b.getUint16(2)/65535,I=b.getUint16(4)/65535,C=2-b.getUint16(8)/65535,J=b.getUint16(10)/65535,p=b.getUint16(14)/65535*2,w=b.getUint16(16)/65535):2===c?(t=!0,M=N=0,U=r(b.getUint32(0)&16777215),V=String.fromCharCode.apply(null,new Uint8Array(a,4)),H=-1):3===c?t=!1:4===c?(M++,q=1):5===c?(N++,q=2):6===c||7===c?(u=.45,I=0,C=1.55,J=0,p=6===c?u:C,w=.5,q=0):8===c?(K=b.getUint8(1)|(b.getUint8(2)&240)<<4,L=b.getUint8(3)|(b.getUint8(2)&15)<<8):9===c&&9===a.byteLength&&g.send(a.slice(1)):(A=r(b.getUint32(0)),B=String.fromCharCode.apply(null,new Uint8Array(a,4)))}function y(){return l[37]||l[65]}function W(){return l[39]||l[68]}function v(){var a=k?y:W;S=(k?W:y)()|0|a()<<1|(l[38]||l[87])<<2}function e(a){return document.getElementById(a)}var z=!1,k=!1,p=.45,w=.5,q=0,u=.45,I=0,B="",A="#7f0",M=0,K=-1,C=1.55,J=0,V="",U="#80f",N=0,L=-1,R=Date.now(),F=1E3,h=e("gameCanvas"),X=h.getContext("2d"),d=[],g,t=!1,H=-1,l={},S=0,m,T=!1,G=!1;document.addEventListener("DOMContentLoaded",function(){function a(a,b){G=!0;m=(a-h.getBoundingClientRect().left)/h.width;k&&(m=1-m);m=Math.min(Math.max(2*m,0),1);T=b-h.getBoundingClientRect().top<.4*h.height}function b(a){G=!1}x();for(var c=0;40>c;++c)d.push([Math.random(),Math.random(),Math.floor(7*Math.random()-3)/800*.06,Math.floor(3*Math.random()+1)/400*.06,16777215*Math.random()|0,.6*Math.random()+.1,(Math.floor(10*Math.random())+5)/2/800,.7*Math.random()+.3]);window.requestAnimationFrame(Q);h.addEventListener("mousemove",function(b){a(b.clientX,b.clientY)});h.addEventListener("touchmove",function(b){1>b.targetTouches.length||(b.preventDefault(),b=b.targetTouches.item(0),a(b.clientX,b.clientY))});h.addEventListener("mouseout",b);h.addEventListener("touchend",b);h.addEventListener("touchcancel",b);e("connect").addEventListener("click",function(){(g?ba:Y)()});e("fullscreen").addEventListener("click",function(){e("fullscreen").checked=!1;var a;["requestFullScreen","mozRequestFullScreen","msRequestFullscreen","webkitRequestFullScreen"].forEach(function(b){a=a||h[b]});a&&a.call(h)});e("pName").addEventListener("change",function(){g||(B=this.value);window.localStorage.n=this.value});e("pColor").addEventListener("change",function(){g||(A=r(parseInt(this.value,16)));window.localStorage.c=this.value});e("flipP1").addEventListener("change",function(){k=this.checked;window.localStorage.f=k?"1":"0";v()});e("notFlipP1").addEventListener("change",function(){k=!this.checked;window.localStorage.f=k?"1":"0";v()});e("background").addEventListener("change",function(){z=this.checked;window.localStorage.b=this.checked?"1":"0"});window.addEventListener("keydown",function(a){l[a.keyCode]=!0;v()},!1);window.addEventListener("keyup",function(a){delete l[a.keyCode];v()},!1);document.addEventListener("fullscreenchange",function(){x()});window.addEventListener("resize",function(){x()});window.localStorage.n&&(B=e("pName").value=window.localStorage.n);window.localStorage.c&&(A=r(e("pColor").value=window.localStorage.c));"1"===window.localStorage.f&&(k=e("flipP1").checked=!0);"1"===window.localStorage.b&&(z=e("background").checked=!0)})})();